<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Plateforme d'idées — Vivante & Multilingue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 
  
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
  /* =========================================================
     Design tokens & base (thème néon sombre)
  ========================================================== */
  /* =========================================================
   IDEA PLATFORM — BIOLUMINESCENT CYBERPUNK DESIGN
   ========================================================== */

/* =========================================================
   DESIGN TOKENS
========================================================== */
:root {
  /* Couleurs de fond — Abysses */
  --void: #050508;
  --abyss: #0a0a12;
  --depth: #0f0f1a;
  --surface: #1a1a2e;
  
  /* Bioluminescence — Néons organiques */
  --bio-cyan: #00ffe5;
  --bio-magenta: #ff00aa;
  --bio-yellow: #ffe600;
  --bio-green: #39ff14;
  --bio-blue: #00b4ff;
  --bio-purple: #c800ff;
  --bio-orange: #ff6b00;
  --bio-pink: #ff69b4;
  
  /* Texte */
  --ink: #f0f5ff;
  --muted: #6b7399;
  --faded: #3d4466;
  
  /* Glows */
  --glow-cyan: 0 0 20px rgba(0, 255, 229, 0.5), 0 0 40px rgba(0, 255, 229, 0.25), 0 0 80px rgba(0, 255, 229, 0.1);
  --glow-magenta: 0 0 20px rgba(255, 0, 170, 0.5), 0 0 40px rgba(255, 0, 170, 0.25), 0 0 80px rgba(255, 0, 170, 0.1);
  --glow-yellow: 0 0 20px rgba(255, 230, 0, 0.5), 0 0 40px rgba(255, 230, 0, 0.25);
  --glow-green: 0 0 20px rgba(57, 255, 20, 0.5), 0 0 40px rgba(57, 255, 20, 0.25);
  
  /* Typographie */
  --font-display: 'Orbitron', 'Audiowide', 'Rajdhani', system-ui, sans-serif;
  --font-body: 'Exo 2', 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace;
  
  /* Rayons organiques */
  --r-blob: 30% 70% 70% 30% / 30% 30% 70% 70%;
  --r-organic: 60% 40% 30% 70% / 60% 30% 70% 40%;
  --r-xl: 28px;
  --r-lg: 22px;
  --r-md: 16px;
  --r-sm: 10px;
  
  /* Ombres profondes */
  --shadow-abyss: 0 30px 100px rgba(0, 0, 0, 0.8), 0 10px 40px rgba(0, 0, 0, 0.6);
  --shadow-float: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 30px rgba(0, 255, 229, 0.1);
}

/* =========================================================
   RESET & BASE
========================================================== */
*, *::before, *::after { box-sizing: border-box; }

html {
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: var(--bio-cyan) var(--abyss);
}

html::-webkit-scrollbar {
  width: 8px;
}

html::-webkit-scrollbar-track {
  background: var(--abyss);
}

html::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, var(--bio-cyan), var(--bio-magenta));
  border-radius: 10px;
}

body {
  margin: 0;
  padding: 0;
  font-family: var(--font-body);
  font-size: 15px;
  line-height: 1.6;
  color: var(--ink);
  background: var(--void);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* =========================================================
   FOND VIVANT — UNIVERS BIOLUMINESCENT
========================================================== */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: -100;
  background: 
    /* Nébuleuses */
    radial-gradient(ellipse 120% 80% at 10% 20%, rgba(0, 255, 229, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse 100% 100% at 90% 80%, rgba(255, 0, 170, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse 80% 60% at 50% 100%, rgba(200, 0, 255, 0.05) 0%, transparent 40%),
    radial-gradient(ellipse 60% 40% at 70% 10%, rgba(0, 180, 255, 0.04) 0%, transparent 40%),
    /* Grille futuriste subtile */
    linear-gradient(rgba(0, 255, 229, 0.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 229, 0.02) 1px, transparent 1px),
    var(--void);
  background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 60px 60px, 60px 60px, 100% 100%;
  animation: nebula-drift 30s ease-in-out infinite alternate;
}

@keyframes nebula-drift {
  0% { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(15deg); }
}

/* Particules flottantes */
.backdrop,
.backdrop-2 {
  position: fixed;
  z-index: -50;
  pointer-events: none;
}

.backdrop {
  top: -30%;
  left: -20%;
  width: 70vw;
  height: 70vw;
  max-width: 800px;
  max-height: 800px;
  background: conic-gradient(from 0deg at 50% 50%, 
    var(--bio-cyan), 
    var(--bio-blue), 
    var(--bio-purple), 
    var(--bio-magenta), 
    var(--bio-pink),
    var(--bio-cyan));
  border-radius: var(--r-blob);
  filter: blur(100px) saturate(150%);
  opacity: 0.15;
  animation: morph-spin 25s linear infinite;
}

.backdrop-2 {
  bottom: -40%;
  right: -20%;
  width: 60vw;
  height: 60vw;
  max-width: 700px;
  max-height: 700px;
  background: conic-gradient(from 180deg at 50% 50%,
    var(--bio-magenta),
    var(--bio-orange),
    var(--bio-yellow),
    var(--bio-green),
    var(--bio-cyan),
    var(--bio-magenta));
  border-radius: var(--r-organic);
  filter: blur(120px) saturate(130%);
  opacity: 0.12;
  animation: morph-spin-reverse 30s linear infinite;
}

/* Masquer les anciens orbs */
.orb, .orb2 { display: none !important; }

@keyframes morph-spin {
  0% { 
    border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    transform: rotate(0deg) scale(1);
  }
  33% { 
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
  }
  66% { 
    border-radius: 40% 60% 60% 40% / 40% 60% 40% 60%;
  }
  100% { 
    border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    transform: rotate(360deg) scale(1.05);
  }
}

@keyframes morph-spin-reverse {
  0% { 
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    transform: rotate(0deg);
  }
  100% { 
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    transform: rotate(-360deg);
  }
}

/* =========================================================
   LAYOUT PRINCIPAL
========================================================== */
.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 24px 160px;
  position: relative;
}

/* =========================================================
   HEADER — HERO ZONE
========================================================== */
.hero {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.brand {
  display: inline-flex;
  align-items: center;
  gap: 14px;
  padding: 14px 22px;
  background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(15, 15, 26, 0.9));
  border: 1px solid rgba(0, 255, 229, 0.3);
  border-radius: 100px;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  box-shadow: var(--glow-cyan), var(--shadow-abyss);
  position: relative;
  overflow: hidden;
}

.brand::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 255, 229, 0.2), transparent);
  animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% { transform: translateX(-50%); }
  50% { transform: translateX(50%); }
}

.brand svg {
  filter: drop-shadow(0 0 8px var(--bio-cyan));
}

.badge {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 12px;
  letter-spacing: 3px;
  text-transform: uppercase;
  background: linear-gradient(90deg, var(--bio-cyan), var(--bio-magenta), var(--bio-yellow));
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: gradient-shift 4s ease infinite;
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.ribbon {
  margin: 20px 0;
  padding: 18px 28px;
  background: linear-gradient(135deg, rgba(255, 0, 170, 0.12), rgba(0, 255, 229, 0.08));
  border: 1px solid rgba(255, 0, 170, 0.25);
  border-left: 4px solid var(--bio-magenta);
  border-radius: 0 var(--r-lg) var(--r-lg) 0;
  font-size: 14px;
  color: var(--ink);
  box-shadow: var(--glow-magenta);
  position: relative;
  overflow: hidden;
}

.ribbon::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 100px;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 0, 170, 0.1));
  animation: pulse-ribbon 3s ease-in-out infinite;
}

@keyframes pulse-ribbon {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.ribbon b {
  font-weight: 800;
  color: var(--bio-magenta);
  text-shadow: 0 0 20px rgba(255, 0, 170, 0.5);
}

h1 {
  margin: 20px 0 12px;
  font-family: var(--font-display);
  font-weight: 900;
  font-size: clamp(36px, 8vw, 56px);
  line-height: 1.1;
  letter-spacing: -1px;
  background: linear-gradient(135deg, 
    #ffffff 0%, 
    var(--bio-cyan) 30%, 
    var(--bio-magenta) 60%, 
    var(--bio-yellow) 100%);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: mega-gradient 8s ease infinite;
  text-shadow: 0 0 80px rgba(0, 255, 229, 0.3);
  position: relative;
}

@keyframes mega-gradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

p.sub {
  margin: 0 0 10px;
  color: var(--muted);
  font-size: 16px;
  max-width: 650px;
  line-height: 1.8;
}

/* =========================================================
   CARTE PRINCIPALE — GLASS MORPHISM NÉON
========================================================== */
.card {
  margin-top: 30px;
  background: linear-gradient(165deg, 
    rgba(15, 15, 26, 0.95) 0%, 
    rgba(10, 10, 18, 0.98) 100%);
  border: 1px solid rgba(0, 255, 229, 0.15);
  border-radius: var(--r-xl);
  box-shadow: var(--shadow-abyss);
  overflow: hidden;
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  position: relative;
}

/* Ligne scanner en haut */
.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, 
    transparent 0%, 
    var(--bio-cyan) 20%, 
    var(--bio-magenta) 50%, 
    var(--bio-yellow) 80%, 
    transparent 100%);
  animation: scan-line 4s linear infinite;
}

@keyframes scan-line {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Coins lumineux */
.card::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: var(--r-xl);
  background: linear-gradient(135deg, 
    var(--bio-cyan) 0%, 
    transparent 20%, 
    transparent 80%, 
    var(--bio-magenta) 100%);
  z-index: -1;
  opacity: 0.5;
  filter: blur(2px);
}

.card-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding: 22px 28px;
  background: linear-gradient(180deg, rgba(20, 20, 35, 0.8), rgba(15, 15, 26, 0.6));
  border-bottom: 1px solid rgba(0, 255, 229, 0.1);
  position: relative;
}

.card-head::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 10%;
  right: 10%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--bio-cyan), transparent);
}

/* =========================================================
   STEP PAGES — ANIMATION ENTRÉE
========================================================== */
.step-page {
  display: none;
  padding: 35px 30px 40px;
  background: radial-gradient(ellipse 80% 50% at 0% 0%, rgba(0, 255, 229, 0.04), transparent),
              radial-gradient(ellipse 60% 40% at 100% 100%, rgba(255, 0, 170, 0.03), transparent),
              transparent;
  animation: page-enter 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.step-page.active {
  display: block;
}

@keyframes page-enter {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.98);
    filter: blur(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}

.spacer { height: 100px; }

/* =========================================================
   STEP 1 — ÉCRAN D'ACCUEIL
========================================================== */
.intro-main {
  display: grid;
  grid-template-columns: 1.4fr 1fr;
  align-items: stretch;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
  gap: 0;
}

.intro-main-main,
.intro-main-side {
  padding: 32px 30px;
}

.intro-main-main {
  border-right: 1px solid rgba(255, 255, 255, 0.05);
  background: radial-gradient(ellipse 100% 80% at 0% 100%, rgba(0, 255, 229, 0.03), transparent);
}

.intro-main-main h2 {
  margin: 0 0 14px;
  font-family: var(--font-display);
  font-size: 26px;
  font-weight: 700;
  color: var(--ink);
  letter-spacing: 0.5px;
}

.intro-lead {
  margin: 0 0 24px;
  font-size: 15px;
  color: var(--muted);
  max-width: 500px;
  line-height: 1.7;
}

.intro-actions {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.intro-actions button {
  flex: 1;
  min-height: 80px;
  font-size: 16px;
  position: relative;
  overflow: hidden;
}

#modeHint {
  margin-top: 16px;
  font-size: 13px;
  color: var(--muted);
  font-family: var(--font-mono);
  letter-spacing: 0.5px;
}

/* Sidebar info */
.intro-main-side {
  background: 
    radial-gradient(ellipse 150% 100% at 100% 0%, rgba(255, 0, 170, 0.06), transparent),
    radial-gradient(ellipse 100% 150% at 0% 100%, rgba(0, 255, 229, 0.04), transparent),
    linear-gradient(145deg, rgba(20, 20, 35, 0.5), rgba(15, 15, 26, 0.8));
  border-left: 1px solid rgba(255, 0, 170, 0.15);
  position: relative;
}

.intro-main-side::before {
  content: '';
  position: absolute;
  top: 20%;
  right: -50%;
  width: 100%;
  height: 60%;
  background: radial-gradient(circle, rgba(255, 0, 170, 0.08), transparent 60%);
  pointer-events: none;
}

.intro-main-side h3 {
  margin: 0 0 16px;
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 700;
  color: var(--bio-magenta);
  text-shadow: 0 0 20px rgba(255, 0, 170, 0.4);
}

.intro-main-side p {
  margin: 0 0 18px;
  font-size: 14px;
  color: var(--muted);
  line-height: 1.7;
}

.intro-mini-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.intro-mini-list li {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  margin-bottom: 14px;
  font-size: 14px;
  color: var(--ink);
  padding: 12px 14px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--r-md);
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.intro-mini-list li:hover {
  background: rgba(255, 0, 170, 0.05);
  border-color: rgba(255, 0, 170, 0.2);
  transform: translateX(5px);
}

.intro-mini-list .pill {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--bio-magenta), var(--bio-purple));
  color: white;
  font-family: var(--font-display);
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  box-shadow: var(--glow-magenta);
}

/* =========================================================
   BOUTONS — STYLE CYBERPUNK
========================================================== */
button {
  border: none;
  border-radius: var(--r-md);
  padding: 14px 24px;
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  letter-spacing: 0.5px;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

button:focus-visible {
  outline: 2px solid var(--bio-cyan);
  outline-offset: 3px;
}

/* Bouton primaire — Cyan lumineux */
.btn-primary {
  background: linear-gradient(135deg, var(--bio-cyan), var(--bio-blue));
  color: var(--void);
  box-shadow: var(--glow-cyan);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.2);
}

.btn-primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.5s ease;
}

.btn-primary:hover:not(:disabled)::before {
  left: 100%;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 0 30px rgba(0, 255, 229, 0.6), 0 0 60px rgba(0, 255, 229, 0.3), 0 15px 40px rgba(0, 0, 0, 0.4);
}

.btn-primary:active:not(:disabled) {
  transform: translateY(-1px) scale(0.98);
}

/* Bouton ghost — Bordure magenta */
.btn-ghost {
  background: rgba(255, 0, 170, 0.08);
  color: var(--bio-magenta);
  border: 1px solid rgba(255, 0, 170, 0.4);
}

.btn-ghost:hover:not(:disabled) {
  background: rgba(255, 0, 170, 0.15);
  box-shadow: var(--glow-magenta);
  transform: translateY(-2px);
}

/* Bouton secondary — Neutre */
.btn-secondary {
  background: rgba(255, 255, 255, 0.05);
  color: var(--muted);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-secondary:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.1);
  color: var(--ink);
  border-color: rgba(255, 255, 255, 0.2);
}

/* Navigation row */
.nav-row {
  display: flex;
  justify-content: space-between;
  gap: 14px;
  margin-top: 30px;
  padding-top: 24px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
  flex-wrap: wrap;
}

/* =========================================================
   PANELS — CARTES INTERNES
========================================================== */
.panel {
  background: linear-gradient(165deg, rgba(26, 26, 46, 0.7), rgba(15, 15, 26, 0.9));
  border: 1px solid rgba(0, 255, 229, 0.12);
  border-radius: var(--r-lg);
  padding: 28px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
}

.panel::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(0, 255, 229, 0.4), transparent);
}

.panel h3 {
  margin: 0 0 10px;
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(90deg, var(--bio-cyan), var(--bio-magenta));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

/* =========================================================
   FORMULAIRES — INPUTS NÉON
========================================================== */
label {
  display: block;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--bio-cyan);
  margin: 22px 0 10px;
  text-shadow: 0 0 10px rgba(0, 255, 229, 0.3);
}

textarea,
input,
select {
  width: 100%;
  padding: 16px 20px;
  background: rgba(5, 5, 10, 0.8);
  border: 2px solid rgba(0, 255, 229, 0.15);
  border-radius: var(--r-md);
  color: var(--ink);
  font-family: var(--font-body);
  font-size: 15px;
  outline: none;
  transition: all 0.3s ease;
}

textarea { 
  min-height: 130px; 
  resize: vertical;
  line-height: 1.6;
}

input::placeholder,
textarea::placeholder {
  color: var(--faded);
  font-style: italic;
}

textarea:focus,
input:focus,
select:focus {
  border-color: var(--bio-cyan);
  box-shadow: 0 0 20px rgba(0, 255, 229, 0.2), inset 0 0 30px rgba(0, 255, 229, 0.03);
  background: rgba(5, 5, 15, 0.95);
}

select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2300ffe5' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 16px center;
  padding-right: 50px;
}

input:disabled,
textarea:disabled,
select:disabled {
  background: rgba(10, 10, 18, 0.5);
  opacity: 0.5;
  cursor: not-allowed;
}

/* Radio & Checkbox */
.radio-group { margin-top: 10px; }

.radio-item {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
  padding: 14px 18px;
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: var(--r-sm);
  cursor: pointer;
  transition: all 0.3s ease;
}

.radio-item:hover {
  background: rgba(0, 255, 229, 0.05);
  border-color: rgba(0, 255, 229, 0.2);
}

.radio-item input {
  width: auto;
  margin: 0;
  accent-color: var(--bio-cyan);
  cursor: pointer;
}

.radio-item span {
  font-size: 14px;
  color: var(--ink);
}

/* =========================================================
   MEDIA PREVIEW
========================================================== */
.media-preview {
  margin-top: 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.media-preview img,
.media-preview video {
  max-width: 130px;
  max-height: 100px;
  border-radius: var(--r-md);
  border: 2px solid rgba(0, 255, 229, 0.3);
  object-fit: cover;
  background: #000;
  box-shadow: var(--glow-cyan);
  transition: all 0.3s ease;
}

.media-preview img:hover,
.media-preview video:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(0, 255, 229, 0.5);
}

/* =========================================================
   STEP 4 — COORDONNÉES
========================================================== */
#step4 .panel {
  padding: 30px;
}

#step4 h3 {
  font-size: 22px;
}

#step4 .field-note {
  font-size: 12px;
  color: var(--muted);
  margin-top: 8px;
  font-style: italic;
}

#step4 .contact-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-top: 20px;
}

#step4 .contact-block {
  padding: 24px;
  border-radius: var(--r-md);
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.03), rgba(0, 0, 0, 0.2));
  border: 1px dashed rgba(0, 255, 229, 0.25);
}

#step4 .contact-block-title {
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
  margin-bottom: 14px;
}

.section-label {
  font-family: var(--font-mono);
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--bio-magenta);
  margin-bottom: 10px;
  text-shadow: 0 0 10px rgba(255, 0, 170, 0.3);
}

/* =========================================================
   STEP 5 — CONTENU IDÉE
========================================================== */
.content {
  display: grid;
  grid-template-columns: 1.15fr 0.85fr;
  gap: 24px;
}

#step5 .panel {
  padding: 28px;
}

#step5 h3 {
  font-size: 22px;
}

#step5 .choice-row {
  display: flex;
  flex-wrap: wrap;
  gap: 14px;
  margin-top: 10px;
}

#step5 .choice-row .radio-item {
  flex: 1;
  min-width: 140px;
  margin-bottom: 0;
  justify-content: center;
  text-align: center;
}

#step5 .field-group {
  margin-top: 22px;
}

#step5 .actions {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 14px;
}

/* Preview panel */
.panel-preview {
  position: relative;
}

.panel-preview .preview-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 20px;
}

.preview-robot {
  flex-shrink: 0;
}

.preview-robot img {
  max-width: 130px;
  height: auto;
  filter: drop-shadow(0 0 30px rgba(0, 255, 229, 0.5));
  animation: float-robot 5s ease-in-out infinite;
}

@keyframes float-robot {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  25% { transform: translateY(-8px) rotate(2deg); }
  75% { transform: translateY(-4px) rotate(-2deg); }
}

.preview-grid {
  margin-top: 24px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
}

.preview-grid strong {
  display: block;
  margin-bottom: 8px;
  font-family: var(--font-mono);
  font-size: 12px;
  letter-spacing: 1px;
  color: var(--bio-cyan);
}

.preview-box {
  min-height: 90px;
  padding: 16px;
  background: rgba(0, 0, 0, 0.4);
  border: 1px dashed rgba(0, 255, 229, 0.25);
  border-radius: var(--r-md);
  font-size: 14px;
  font-family: var(--font-mono);
  color: var(--muted);
  white-space: pre-wrap;
  line-height: 1.6;
}

.helper {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-top: 22px;
  padding: 16px;
  background: rgba(0, 180, 255, 0.05);
  border: 1px solid rgba(0, 180, 255, 0.15);
  border-radius: var(--r-sm);
  font-size: 13px;
  color: var(--muted);
  line-height: 1.6;
}

.helper svg {
  flex-shrink: 0;
  filter: drop-shadow(0 0 5px var(--bio-blue));
}

/* =========================================================
   STEP VOICE — PROFIL VOCAL
========================================================== */
#stepVoice .voice-shell {
  position: relative;
  padding: 35px;
  border-radius: var(--r-xl);
  background: linear-gradient(165deg, rgba(15, 15, 26, 0.95), rgba(10, 10, 18, 0.98));
  border: 1px solid rgba(255, 0, 170, 0.2);
  overflow: hidden;
  box-shadow: var(--shadow-abyss);
}

#stepVoice .voice-bg {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  opacity: 0.12;
}

#stepVoice .voice-bg::before {
  content: '';
  position: absolute;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(255, 0, 170, 0.2), transparent 60%);
  filter: blur(40px);
  animation: pulse-bg 4s ease-in-out infinite;
}

@keyframes pulse-bg {
  0%, 100% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.2); opacity: 0.8; }
}

#stepVoice .voice-bg img {
  max-width: 350px;
  filter: drop-shadow(0 0 40px rgba(255, 0, 170, 0.5)) saturate(0.8);
  animation: levitate 6s ease-in-out infinite;
}

@keyframes levitate {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-25px) rotate(3deg); }
}

#stepVoice .voice-foreground {
  position: relative;
  z-index: 1;
}

#stepVoice #voiceLangCard.panel,
#stepVoice #voiceProfileCard.panel {
  background: linear-gradient(165deg, rgba(20, 20, 35, 0.9), rgba(10, 10, 18, 0.95));
  border: 1px solid rgba(255, 0, 170, 0.25);
  box-shadow: var(--glow-magenta);
}

.profile-bilingual-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-top: 20px;
}

.voice-col {
  padding: 26px;
  border-radius: var(--r-lg);
  position: relative;
  overflow: hidden;
}

.voice-col--lang {
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.08), rgba(200, 0, 255, 0.04));
  border: 1px solid rgba(255, 0, 170, 0.25);
}

.voice-col--lang::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255, 0, 170, 0.15), transparent 60%);
  pointer-events: none;
}

.voice-col--fr {
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.06), rgba(0, 180, 255, 0.03));
  border: 1px solid rgba(0, 255, 229, 0.2);
}

.voice-col--fr::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(0, 255, 229, 0.1), transparent 60%);
  pointer-events: none;
}

.voice-col h3 {
  margin: 0 0 10px;
  font-size: 18px;
}

.voice-col p {
  margin: 0 0 14px;
  font-size: 14px;
  color: var(--muted);
  line-height: 1.6;
}

.voice-col ul {
  list-style: none;
  margin: 0 0 18px;
  padding: 0;
}

.voice-col li {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 10px;
  font-size: 14px;
  color: var(--ink);
}

.voice-col .pill {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--bio-magenta), var(--bio-purple));
  color: white;
  font-family: var(--font-display);
  font-size: 11px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  box-shadow: var(--glow-magenta);
}

.voice-col--fr .pill {
  background: linear-gradient(135deg, var(--bio-cyan), var(--bio-blue));
  box-shadow: var(--glow-cyan);
}

.voice-col .actions {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

#stepVoice .notice {
  font-size: 12px;
  color: var(--muted);
  margin-top: 16px;
  padding: 12px 14px;
  background: rgba(255, 230, 0, 0.05);
  border-left: 3px solid var(--bio-yellow);
  border-radius: 0 var(--r-sm) var(--r-sm) 0;
}

.voice-preview-block {
  margin-top: 26px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.voice-preview-block strong {
  display: block;
  margin-bottom: 8px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--bio-cyan);
}

.lang-select {
  min-width: 240px;
  padding: 14px 50px 14px 18px;
  background: rgba(5, 5, 10, 0.9);
  border: 2px solid rgba(255, 0, 170, 0.3);
  border-radius: var(--r-md);
  color: var(--ink);
  font-size: 14px;
}

.lang-select:focus {
  border-color: var(--bio-magenta);
  box-shadow: var(--glow-magenta);
}

/* Mobile toggle */
.voice-toggle { display: none; }

.voice-switch {
  display: none;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
  margin-bottom: 18px;
}

.voice-switch-label {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--bio-magenta);
  letter-spacing: 0.5px;
}

.voice-switch-btn {
  width: 46px;
  height: 46px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--bio-magenta), var(--bio-purple));
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  box-shadow: var(--glow-magenta);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.voice-switch-btn:hover {
  transform: rotate(180deg) scale(1.1);
}

/* =========================================================
   BARRE DE SOUMISSION FLOTTANTE
========================================================== */
.submitbar {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 24px;
  z-index: 1000;
  display: flex;
  justify-content: center;
  pointer-events: none;
}

.submitbar .inner {
  pointer-events: auto;
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 14px 20px;
  background: linear-gradient(135deg, rgba(10, 10, 18, 0.98), rgba(15, 15, 26, 0.95));
  border: 1px solid rgba(0, 255, 229, 0.3);
  border-radius: 100px;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  box-shadow: var(--glow-cyan), var(--shadow-abyss);
}

#submitBtn {
  border-radius: 100px;
  padding: 14px 28px;
}

#statusMsg {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--muted);
  letter-spacing: 0.5px;
}

/* =========================================================
   PAGE MERCI — CÉLÉBRATION
========================================================== */
.thank-panel {
  padding: 50px 40px;
  text-align: center;
  border-radius: var(--r-xl);
  background: 
    radial-gradient(ellipse 80% 60% at 30% 20%, rgba(0, 255, 229, 0.1), transparent),
    radial-gradient(ellipse 60% 80% at 70% 80%, rgba(255, 0, 170, 0.08), transparent),
    radial-gradient(ellipse 100% 50% at 50% 50%, rgba(255, 230, 0, 0.05), transparent),
    linear-gradient(165deg, rgba(20, 20, 35, 0.9), rgba(10, 10, 18, 0.95));
  border: 1px solid rgba(0, 255, 229, 0.2);
  box-shadow: var(--shadow-abyss);
  position: relative;
  overflow: hidden;
}

/* Confettis animés */
.thank-panel::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: 
    radial-gradient(2px 2px at 10% 20%, var(--bio-cyan), transparent),
    radial-gradient(2px 2px at 30% 70%, var(--bio-magenta), transparent),
    radial-gradient(2px 2px at 50% 30%, var(--bio-yellow), transparent),
    radial-gradient(2px 2px at 70% 60%, var(--bio-green), transparent),
    radial-gradient(2px 2px at 90% 40%, var(--bio-blue), transparent),
    radial-gradient(2px 2px at 20% 90%, var(--bio-purple), transparent);
  animation: confetti-fall 10s linear infinite;
  opacity: 0.6;
}

@keyframes confetti-fall {
  0% { transform: translateY(-100%); }
  100% { transform: translateY(100%); }
}

.thank-layout {
  display: grid;
  grid-template-columns: 1.3fr 0.8fr;
  gap: 30px;
  align-items: center;
  position: relative;
  z-index: 1;
}

.thank-text {
  text-align: left;
}

.thank-text h2 {
  margin: 0 0 16px;
  font-family: var(--font-display);
  font-size: clamp(28px, 5vw, 38px);
  font-weight: 900;
  background: linear-gradient(135deg, #fff 0%, var(--bio-cyan) 40%, var(--bio-magenta) 70%, var(--bio-yellow) 100%);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: mega-gradient 5s ease infinite;
}

.thank-text p {
  font-size: 15px;
  color: var(--muted);
  margin: 10px 0;
  line-height: 1.8;
}

.thank-highlight {
  margin: 22px 0;
  padding: 18px 24px;
  background: linear-gradient(135deg, rgba(255, 230, 0, 0.1), rgba(57, 255, 20, 0.06));
  border: 1px dashed rgba(255, 230, 0, 0.4);
  border-radius: var(--r-md);
  font-size: 15px;
  color: var(--bio-yellow);
  text-shadow: 0 0 10px rgba(255, 230, 0, 0.3);
}

.thank-robot {
  display: flex;
  align-items: center;
  justify-content: center;
}

.thank-robot-orbit {
  position: relative;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(0, 255, 229, 0.15), transparent 60%);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: orbit-pulse 3s ease-in-out infinite;
}

@keyframes orbit-pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 229, 0.3); }
  50% { box-shadow: 0 0 0 30px rgba(0, 255, 229, 0); }
}

.thank-robot-orbit::before {
  content: '';
  position: absolute;
  inset: 15%;
  border: 2px dashed rgba(0, 255, 229, 0.3);
  border-radius: 50%;
  animation: spin 15s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.thank-robot-orbit::after {
  content: '';
  position: absolute;
  inset: 5%;
  border: 1px dotted rgba(255, 0, 170, 0.2);
  border-radius: 50%;
  animation: spin 20s linear infinite reverse;
}

.thank-robot-orbit img {
  max-width: 65%;
  height: auto;
  filter: drop-shadow(0 0 30px rgba(0, 255, 229, 0.6));
  animation: celebrate 3s ease-in-out infinite;
}

@keyframes celebrate {
  0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
  25% { transform: translateY(-12px) scale(1.05) rotate(3deg); }
  50% { transform: translateY(-6px) scale(1.02) rotate(-2deg); }
  75% { transform: translateY(-10px) scale(1.03) rotate(2deg); }
}

/* =========================================================
   UTILITAIRES
========================================================== */
.muted { color: var(--muted); }
.muted.small, .small { font-size: 13px; }
audio { width: 100%; margin-top: 12px; border-radius: var(--r-sm); }

/* =========================================================
   RESPONSIVE — MOBILE FIRST
========================================================== */
@media (max-width: 1000px) {
  .content { grid-template-columns: 1fr; }
  .profile-bilingual-grid { grid-template-columns: 1fr; }
  .voice-preview-block { grid-template-columns: 1fr; }
  .preview-grid { grid-template-columns: 1fr; }
  
  #stepVoice .voice-shell { padding: 24px; }
  #stepVoice .voice-bg img { width: 60vw; opacity: 0.08; }
  
  .voice-switch { display: flex; }
  #voiceLangCol, #voiceFrCol { display: none; }
  #voiceLangCol.is-active, #voiceFrCol.is-active { display: block; }
}

@media (max-width: 900px) {
  .intro-main { grid-template-columns: 1fr; }
  .intro-main-main { border-right: none; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
  #step4 .contact-layout { grid-template-columns: 1fr; }
  .thank-layout { grid-template-columns: 1fr; text-align: center; }
  .thank-text { text-align: center; }
  .thank-robot { order: -1; margin-bottom: 20px; }
  .preview-robot img { max-width: 100px; }
}

@media (max-width: 600px) {
  .wrap { padding: 24px 16px 140px; }
  
  h1 { font-size: 32px; }
  
  .hero { flex-direction: column; align-items: flex-start; }
  
  .brand { padding: 10px 16px; }
  .badge { font-size: 10px; letter-spacing: 2px; }
  
  .ribbon { padding: 14px 18px; font-size: 13px; }
  
  .card-head { flex-direction: column; align-items: flex-start; padding: 18px 20px; }
  
  .step-page { padding: 24px 20px; }
  
  .panel { padding: 22px 18px; }
  
  .intro-main-main, .intro-main-side { padding: 24px 20px; }
  
  .intro-actions button { min-height: 70px; font-size: 15px; }
  
  .nav-row { flex-direction: column; gap: 12px; }
  .nav-row button { width: 100%; }
  
  #step5 .choice-row { flex-direction: column; }
  #step5 .actions { flex-direction: column; }
  #step5 .actions button { width: 100%; }
  
  .voice-col { padding: 20px; }
  .voice-col .actions { flex-direction: column; }
  .voice-col .actions button { width: 100%; }
  
  .lang-select { min-width: 100%; width: 100%; margin-top: 12px; }
  
  .submitbar { bottom: 16px; }
  .submitbar .inner { padding: 10px 14px; border-radius: 50px; flex-wrap: wrap; justify-content: center; }
  #submitBtn { padding: 12px 20px; font-size: 13px; }
  #statusMsg { font-size: 11px; text-align: center; }
  
  .thank-panel { padding: 30px 20px; }
  .thank-robot-orbit { width: 160px; height: 160px; }
  
  .backdrop, .backdrop-2 { opacity: 0.08; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .backdrop, .backdrop-2 { animation: none; }
}

/* =========================================================
   MOBILE SIMPLIFIÉ — ÉCRAN D'ACCUEIL
========================================================== */
@media (max-width: 600px) {
  .ribbon, .sub, .intro-main-side { display: none !important; }
  
  h1 { text-align: center; margin-bottom: 24px; }
  
  .intro-main-main { background: none; border: none; }
  .intro-main-main h2 { text-align: center; font-size: 22px; }
  .intro-lead { display: none; }
  
  .intro-actions { gap: 14px; }
  .intro-actions button { min-height: 76px; border-radius: var(--r-lg); }
}

/* =========================================================
   GOOGLE FONTS IMPORT (à ajouter dans le <head>)
========================================================== */
/* 
Ajoute cette ligne dans ton <head> :
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
*/
@media (max-width: 768px) {
  
  /* ===== NETTOYAGE GLOBAL ===== */
  
  /* Réduire les effets de fond sur mobile (performance + clarté) */
  .backdrop, .backdrop-2 {
    display: none !important;
  }
  
  body::before {
    background: 
      radial-gradient(ellipse 100% 50% at 50% 0%, rgba(0, 255, 229, 0.05) 0%, transparent 50%),
      var(--void);
    animation: none;
  }
  
  /* Padding global réduit */
  .wrap {
    padding: 16px 14px 120px;
    margin: 0;
  }
  
  /* ===== HEADER MINIMALISTE ===== */
  
  .hero {
    margin-bottom: 12px;
  }
  
  .brand {
    padding: 8px 14px;
    box-shadow: none;
    border: 1px solid rgba(0, 255, 229, 0.2);
  }
  
  .brand::before {
    display: none;
  }
  
  .brand svg {
    width: 14px;
    height: 14px;
  }
  
  .badge {
    font-size: 9px;
    letter-spacing: 1.5px;
  }
  
  /* Masquer éléments superflus header */
  .ribbon {
    display: none !important;
  }
  
  p.sub {
    display: none !important;
  }
  
  /* Titre principal compact */
  h1 {
    font-size: 26px !important;
    margin: 12px 0 8px;
    text-align: center;
    letter-spacing: -0.5px;
  }
  
  /* ===== CARTE PRINCIPALE ===== */
  
  .card {
    margin-top: 16px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
  }
  
  .card::before,
  .card::after {
    display: none;
  }
  
  .card-head {
    padding: 14px 16px;
    min-height: auto;
  }
  
  /* ===== STEP PAGES ===== */
  
  .step-page {
    padding: 20px 16px 24px;
    animation: none;
  }
  
  .spacer {
    height: 60px;
  }
  
  /* ===== STEP 1 — ACCUEIL ÉPURÉ ===== */
  
  .intro-main {
    display: block;
    border: none;
  }
  
  .intro-main-main {
    padding: 16px 0 20px;
    border: none;
    background: none;
  }
  
  .intro-main-side {
    display: none !important;
  }
  
  .intro-main-main h2 {
    font-size: 18px;
    text-align: center;
    margin-bottom: 20px;
  }
  
  .intro-lead {
    display: none !important;
  }
  
  /* Boutons de mode simplifiés */
  .intro-actions {
    gap: 12px;
  }
  
  .intro-actions button {
    min-height: 64px;
    padding: 16px 20px;
    border-radius: 16px;
  }
  
  .intro-actions button::before {
    display: none;
  }
  
  #modeHint {
    font-size: 11px;
    text-align: center;
    margin-top: 12px;
  }
  
  /* Captcha compact */
  #captchaRow {
    margin-top: 20px;
    padding: 16px;
    border-radius: 12px;
  }
  
  #captchaRow p {
    font-size: 11px;
    margin-top: 10px;
  }
  
  /* ===== PANELS SIMPLIFIÉS ===== */
  
  .panel {
    padding: 18px 16px;
    border-radius: 16px;
    box-shadow: none;
    border: 1px solid rgba(0, 255, 229, 0.1);
  }
  
  .panel::before {
    display: none;
  }
  
  .panel h3 {
    font-size: 17px;
    margin-bottom: 6px;
  }
  
  .panel > p.muted {
    font-size: 13px;
    margin-bottom: 16px;
  }
  
  /* ===== FORMULAIRES COMPACTS ===== */
  
  label {
    font-size: 10px;
    margin: 16px 0 6px;
    letter-spacing: 1px;
  }
  
  input, select, textarea {
    padding: 14px 16px;
    font-size: 14px;
    border-radius: 12px;
    border-width: 1px;
  }
  
  input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 10px rgba(0, 255, 229, 0.15);
  }
  
  textarea {
    min-height: 100px;
  }
  
  /* Radio items compacts */
  .radio-item {
    padding: 12px 14px;
    margin-bottom: 8px;
    border-radius: 10px;
  }
  
  .radio-item span {
    font-size: 13px;
  }
  
  /* ===== BOUTONS MOBILE ===== */
  
  button {
    padding: 12px 20px;
    font-size: 13px;
    border-radius: 12px;
  }
  
  .btn-primary {
    box-shadow: 0 0 15px rgba(0, 255, 229, 0.3);
  }
  
  .btn-primary:hover:not(:disabled) {
    transform: none;
    box-shadow: 0 0 20px rgba(0, 255, 229, 0.4);
  }
  
  .nav-row {
    margin-top: 20px;
    padding-top: 16px;
    gap: 10px;
  }
  
  .nav-row button {
    padding: 14px 18px;
  }
  
  /* ===== STEP 3 — PROFIL SIMPLIFIÉ ===== */
  
  #otherSiteRow, #otherServiceRow {
    margin-top: 8px;
  }
  
  /* ===== STEP 4 — COORDONNÉES ===== */
  
  #step4 .contact-layout {
    gap: 16px;
  }
  
  #step4 .contact-block {
    padding: 16px;
    border-radius: 12px;
  }
  
  #step4 .contact-block-title {
    font-size: 13px;
    margin-bottom: 10px;
  }
  
  .section-label {
    font-size: 9px;
    margin-bottom: 8px;
  }
  
  .field-note {
    font-size: 11px;
  }
  
  /* ===== STEP 5 — CONTENU IDÉE ===== */
  
  .content {
    gap: 16px;
  }
  
  /* Masquer le robot preview sur mobile */
  .preview-robot {
    display: none !important;
  }
  
  .preview-top {
    display: block;
  }
  
  #step5 .choice-row {
    gap: 8px;
  }
  
  #step5 .choice-row .radio-item {
    min-width: auto;
    flex: 1 1 calc(50% - 4px);
    padding: 10px 12px;
    font-size: 12px;
  }
  
  #step5 .field-group {
    margin-top: 16px;
  }
  
  #step5 .actions {
    gap: 8px;
  }
  
  #step5 .actions button {
    padding: 12px 16px;
    font-size: 12px;
  }
  
  /* Preview boxes compactes */
  .preview-grid {
    gap: 12px;
    margin-top: 16px;
  }
  
  .preview-grid strong {
    font-size: 11px;
    margin-bottom: 6px;
  }
  
  .preview-box {
    min-height: 70px;
    padding: 12px;
    font-size: 12px;
    border-radius: 10px;
  }
  
  /* Masquer le helper sur mobile */
  .helper {
    display: none !important;
  }
  
  /* Media preview compact */
  .media-preview {
    gap: 8px;
    margin-top: 12px;
  }
  
  .media-preview img, .media-preview video {
    max-width: 80px;
    max-height: 60px;
    border-radius: 8px;
    border-width: 1px;
  }
  
  /* Audio player compact */
  audio {
    margin-top: 10px;
    height: 40px;
  }
  
  /* ===== STEP VOICE — PROFIL VOCAL ===== */
  
  #stepVoice .voice-shell {
    padding: 18px 14px;
    border-radius: 16px;
  }
  
  #stepVoice .voice-bg {
    display: none !important;
  }
  
  #stepVoice .voice-bg::before {
    display: none;
  }
  
  #voiceLangCard.panel, #voiceProfileCard.panel {
    padding: 16px;
    box-shadow: none;
  }
  
  #voiceLangCard h3, #voiceProfileCard h3 {
    font-size: 16px;
  }
  
  #voiceLangCard p, #voiceProfileCard p {
    font-size: 13px;
  }
  
  /* Actions langue */
  #voiceLangCard .actions,
  #stepVoice .actions {
    flex-direction: column;
    gap: 10px;
  }
  
  .lang-select {
    min-width: 100%;
    padding: 12px 40px 12px 14px;
    font-size: 13px;
    border-radius: 10px;
  }
  
  /* Colonnes voix */
  .voice-col {
    padding: 16px;
    border-radius: 12px;
  }
  
  .voice-col h3 {
    font-size: 15px;
  }
  
  .voice-col p {
    font-size: 12px;
    margin-bottom: 10px;
  }
  
  .voice-col ul {
    margin-bottom: 14px;
  }
  
  .voice-col li {
    gap: 10px;
    margin-bottom: 8px;
    font-size: 12px;
  }
  
  .voice-col .pill {
    width: 22px;
    height: 22px;
    font-size: 10px;
  }
  
  #stepVoice .notice {
    font-size: 11px;
    padding: 10px 12px;
    margin-top: 12px;
  }
  
  .voice-preview-block {
    gap: 12px;
    margin-top: 18px;
  }
  
  .voice-preview-block strong {
    font-size: 11px;
  }
  
  /* Switch mobile compact */
  .voice-switch {
    margin-bottom: 14px;
  }
  
  .voice-switch-label {
    font-size: 11px;
  }
  
  .voice-switch-btn {
    width: 40px;
    height: 40px;
  }
  
  #voiceMissingMsg {
    font-size: 12px;
    margin-top: 12px;
  }
  
  /* ===== CONFIRMATION — LANGUES ===== */
  
  #langConfirmRow {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  #langConfirmLabel {
    font-size: 12px;
  }
  
  #langConfirmRow > div {
    width: 100%;
    display: flex;
    gap: 10px;
  }
  
  #langConfirmNo, #langConfirmYes {
    flex: 1;
    padding: 12px !important;
  }
  
  /* ===== BARRE DE SOUMISSION ===== */
  
  .submitbar {
    bottom: 12px;
    left: 12px;
    right: 12px;
  }
  
  .submitbar .inner {
    width: 100%;
    padding: 10px 14px;
    border-radius: 16px;
    gap: 10px;
    justify-content: space-between;
    box-shadow: 0 0 20px rgba(0, 255, 229, 0.2), 0 10px 30px rgba(0, 0, 0, 0.5);
  }
  
  #submitBtn {
    padding: 12px 18px;
    font-size: 12px;
    border-radius: 12px;
    flex-shrink: 0;
  }
  
  #statusMsg {
    font-size: 10px;
    flex: 1;
    text-align: right;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  /* ===== PAGE MERCI SIMPLIFIÉE ===== */
  
  .thank-panel {
    padding: 30px 20px;
    border-radius: 16px;
  }
  
  .thank-panel::before {
    display: none;
  }
  
  .thank-layout {
    display: block;
  }
  
  .thank-robot {
    margin-bottom: 20px;
  }
  
  .thank-robot-orbit {
    width: 120px;
    height: 120px;
    margin: 0 auto;
  }
  
  .thank-robot-orbit::before,
  .thank-robot-orbit::after {
    display: none;
  }
  
  .thank-robot-orbit img {
    max-width: 70%;
    animation: none;
    filter: drop-shadow(0 0 15px rgba(0, 255, 229, 0.4));
  }
  
  .thank-text {
    text-align: center;
  }
  
  .thank-text h2 {
    font-size: 24px;
    margin-bottom: 12px;
    animation: none;
  }
  
  .thank-text p {
    font-size: 13px;
    margin: 8px 0;
    line-height: 1.6;
  }
  
  .thank-highlight {
    margin: 16px 0;
    padding: 14px 16px;
    font-size: 13px;
    border-radius: 10px;
  }
  
  .thank-text .btn-secondary {
    width: 100%;
    margin-top: 10px;
  }
}

/* ===== ENCORE PLUS PETIT (iPhone SE, etc.) ===== */

@media (max-width: 380px) {
  
  .wrap {
    padding: 12px 10px 110px;
  }
  
  h1 {
    font-size: 22px !important;
  }
  
  .brand {
    padding: 6px 10px;
  }
  
  .badge {
    font-size: 8px;
  }
  
  .intro-main-main h2 {
    font-size: 16px;
  }
  
  .intro-actions button {
    min-height: 58px;
    padding: 14px 16px;
    font-size: 13px;
  }
  
  .panel {
    padding: 14px 12px;
  }
  
  .panel h3 {
    font-size: 15px;
  }
  
  input, select, textarea {
    padding: 12px 14px;
    font-size: 13px;
  }
  
  label {
    font-size: 9px;
  }
  
  button {
    padding: 10px 16px;
    font-size: 12px;
  }
  
  #step5 .choice-row .radio-item {
    flex: 1 1 100%;
    padding: 10px;
  }
  
  .submitbar .inner {
    padding: 8px 10px;
  }
  
  #submitBtn {
    padding: 10px 14px;
    font-size: 11px;
  }
  
  .thank-text h2 {
    font-size: 20px;
  }
  
  .thank-robot-orbit {
    width: 100px;
    height: 100px;
  }
}

/* ===== DÉSACTIVER TOUTES LES ANIMATIONS SUR MOBILE ===== */

@media (max-width: 768px) {
  *, *::before, *::after {
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.2s !important;
  }
}

/* ===== PROFILE BILINGUAL GRID ===== */
#step3 .profile-bilingual-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-top: 20px;
}

#step3 .voice-col {
  padding: 26px;
  border-radius: var(--r-lg);
  position: relative;
  overflow: hidden;
}

#step3 .voice-col--lang {
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.08), rgba(200, 0, 255, 0.04));
  border: 1px solid rgba(255, 0, 170, 0.25);
}

#step3 .voice-col--fr {
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.06), rgba(0, 180, 255, 0.03));
  border: 1px solid rgba(0, 255, 229, 0.2);
}

/* Switch mobile pour profil */
.profile-switch {
  display: none;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
  margin-bottom: 18px;
}

/* Mode non-bilingue : colonne unique centrée */
#step3 .profile-bilingual-grid.single-col {
  grid-template-columns: 1fr;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

#step3 .profile-bilingual-grid.single-col .voice-col--lang {
  display: none;
}

#step3 .profile-bilingual-grid.single-col .voice-col--fr {
  background: transparent;
  border: none;
  padding: 0;
}

/* Responsive */
@media (max-width: 1000px) {
  #step3 .profile-bilingual-grid {
    grid-template-columns: 1fr;
  }
  
  .profile-switch {
    display: flex;
  }
  
  #profileLangCol, #profileFrCol {
    display: none;
  }
  
  #profileLangCol.is-active, #profileFrCol.is-active {
    display: block;
  }
  
  #step3 .profile-bilingual-grid.single-col .voice-col--fr {
    display: block;
  }
}

/* ===== STEP 4 CONTACT BILINGUAL GRID ===== */

#step4 .panel {
  padding: 30px;
}

#step4 h3 {
  font-size: 22px;
  margin-bottom: 20px;
}

/* Grille bilingue pour les coordonnées */
#step4 .contact-bilingual-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

#step4 .voice-col {
  padding: 26px;
  border-radius: var(--r-lg);
  position: relative;
  overflow: hidden;
}

#step4 .voice-col--lang {
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.08), rgba(200, 0, 255, 0.04));
  border: 1px solid rgba(255, 0, 170, 0.25);
}

#step4 .voice-col--fr {
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.06), rgba(0, 180, 255, 0.03));
  border: 1px solid rgba(0, 255, 229, 0.2);
}

/* Layout interne des colonnes */
#step4 .contact-layout-inner {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

#step4 .contact-block {
  padding: 20px;
  border-radius: var(--r-md);
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.03), rgba(0, 0, 0, 0.2));
  border: 1px dashed rgba(0, 255, 229, 0.25);
}

#step4 .voice-col--lang .contact-block {
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.05), rgba(0, 0, 0, 0.2));
  border: 1px dashed rgba(255, 0, 170, 0.3);
}

#step4 .contact-block-title {
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
  margin-bottom: 14px;
}

#step4 .field-note {
  font-size: 12px;
  color: var(--muted);
  margin-top: 8px;
  font-style: italic;
}

/* Switch mobile pour contact */
.contact-switch {
  display: none;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
  margin-bottom: 18px;
}

/* Mode non-bilingue : colonne unique centrée */
#step4 .contact-bilingual-grid.single-col {
  grid-template-columns: 1fr;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

#step4 .contact-bilingual-grid.single-col .voice-col--lang {
  display: none;
}

#step4 .contact-bilingual-grid.single-col .voice-col--fr {
  background: transparent;
  border: none;
  padding: 0;
}

#step4 .contact-bilingual-grid.single-col .contact-layout-inner {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
}

/* Responsive */
@media (max-width: 1000px) {
  #step4 .contact-bilingual-grid {
    grid-template-columns: 1fr;
  }
  
  #step4 .contact-bilingual-grid.single-col .contact-layout-inner {
    grid-template-columns: 1fr;
  }
  
  .contact-switch {
    display: flex;
  }
  
  #contactLangCol, #contactFrCol {
    display: none;
  }
  
  #contactLangCol.is-active, #contactFrCol.is-active {
    display: block;
  }
  
  #step4 .contact-bilingual-grid.single-col .voice-col--fr {
    display: block;
  }
}

@media (max-width: 768px) {
  #step4 .voice-col {
    padding: 18px 14px;
  }
  
  #step4 .contact-block {
    padding: 16px;
  }
  
  #step4 .contact-block-title {
    font-size: 13px;
  }
  
  .contact-switch {
    margin-bottom: 14px;
  }
}


/* ===== STEP 5 IDEA BILINGUAL STYLES ===== */

/* En-tête bilingue */
#step5 .idea-header-bilingual {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

#step5 .idea-header-lang {
  padding: 16px 20px;
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.08), rgba(200, 0, 255, 0.04));
  border: 1px solid rgba(255, 0, 170, 0.25);
  border-radius: var(--r-md);
}

#step5 .idea-header-fr {
  padding: 16px 20px;
  background: linear-gradient(145deg, rgba(0, 255, 229, 0.06), rgba(0, 180, 255, 0.03));
  border: 1px solid rgba(0, 255, 229, 0.2);
  border-radius: var(--r-md);
}

#step5 .idea-header-bilingual h3 {
  margin: 0 0 8px;
  font-size: 18px;
}

#step5 .idea-header-bilingual p {
  margin: 0;
}

/* Switch mobile */
.idea-switch {
  display: none;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
  margin-bottom: 18px;
}

/* Labels bilingues côte à côte */
.bilingual-label {
  display: flex;
  gap: 16px;
  align-items: baseline;
  margin: 22px 0 10px;
}

.bilingual-label .label-lang {
  flex: 1;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--bio-magenta);
  text-shadow: 0 0 10px rgba(255, 0, 170, 0.3);
}

.bilingual-label .label-fr {
  flex: 1;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--bio-cyan);
  text-shadow: 0 0 10px rgba(0, 255, 229, 0.3);
}

/* Textes bilingues dans les boutons et checkboxes */
.bilingual-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.bilingual-text .text-lang {
  color: var(--bio-magenta);
  font-size: 0.9em;
}

.bilingual-text .text-fr {
  color: var(--ink);
  font-size: 1em;
}

/* Dans les radio-items, afficher sur une ligne */
.radio-item .bilingual-text {
  flex-direction: row;
  gap: 8px;
  align-items: center;
}

.radio-item .bilingual-text .text-lang::after {
  content: " / ";
  color: var(--faded);
}

/* Boutons avec texte bilingue */
button .bilingual-text {
  flex-direction: row;
  gap: 0;
}

button .bilingual-text .text-lang {
  display: none; /* On affiche seulement sur desktop en mode bilingue */
}

button .bilingual-text .text-fr {
  color: inherit;
}

/* Mode bilingue actif */
.bilingual-mode button .bilingual-text .text-lang {
  display: inline;
}

.bilingual-mode button .bilingual-text .text-lang::after {
  content: " / ";
  color: var(--faded);
  margin: 0 4px;
}

/* Mode non-bilingue (français uniquement) */
#step5 .idea-header-bilingual.single-lang {
  grid-template-columns: 1fr;
}

#step5 .idea-header-bilingual.single-lang .idea-header-lang {
  display: none;
}

#step5 .idea-header-bilingual.single-lang .idea-header-fr {
  background: transparent;
  border: none;
  padding: 0;
}

.bilingual-label.single-lang .label-lang {
  display: none;
}

.bilingual-label.single-lang .label-fr {
  flex: none;
}

.bilingual-text.single-lang .text-lang {
  display: none !important;
}

.radio-item .bilingual-text.single-lang .text-lang::after {
  display: none;
}

/* Responsive */
@media (max-width: 1000px) {
  #step5 .idea-header-bilingual {
    grid-template-columns: 1fr;
  }
  
  #step5 .idea-header-lang,
  #step5 .idea-header-fr {
    display: none;
  }
  
  #step5 .idea-header-lang.is-active,
  #step5 .idea-header-fr.is-active {
    display: block;
  }
  
  #step5 .idea-header-bilingual.single-lang .idea-header-fr {
    display: block;
  }
  
  .idea-switch {
    display: flex;
  }
  
  .bilingual-label {
    flex-direction: column;
    gap: 4px;
  }
  
  .bilingual-label .label-lang,
  .bilingual-label .label-fr {
    display: none;
  }
  
  .bilingual-label .label-lang.is-active,
  .bilingual-label .label-fr.is-active {
    display: block;
  }
  
  .bilingual-label.single-lang .label-fr {
    display: block;
  }
  
  /* Textes bilingues en mobile */
  .bilingual-text .text-lang,
  .bilingual-text .text-fr {
    display: none;
  }
  
  .bilingual-text .text-lang.is-active,
  .bilingual-text .text-fr.is-active {
    display: inline;
  }
  
  .bilingual-text.single-lang .text-fr {
    display: inline !important;
  }
  
  .radio-item .bilingual-text {
    flex-direction: column;
    gap: 2px;
    align-items: flex-start;
  }
  
  .radio-item .bilingual-text .text-lang::after {
    display: none;
  }
}

@media (max-width: 768px) {
  #step5 .idea-header-bilingual {
    margin-bottom: 16px;
    padding-bottom: 16px;
  }
  
  #step5 .idea-header-lang,
  #step5 .idea-header-fr {
    padding: 12px 14px;
  }
  
  #step5 .idea-header-bilingual h3 {
    font-size: 16px;
  }
  
  .idea-switch {
    margin-bottom: 14px;
  }
  
  .bilingual-label {
    margin: 16px 0 8px;
  }
}


gle lang · CSS
Copier

/* ============================================================
   STEP 5 - LANGUE UNIQUE (pas de bilingue côte à côte)
   Remplace les styles existants de step5 dans ton CSS
   ============================================================ */

/* Masquer complètement l'en-tête bilingue - on n'en a plus besoin */
#step5 .idea-header-bilingual {
  display: block; /* Plus de grid */
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

/* Masquer la colonne FR par défaut */
#step5 .idea-header-fr {
  display: none !important;
}

/* Afficher uniquement la colonne de la langue choisie */
#step5 .idea-header-lang {
  display: block;
  padding: 16px 20px;
  background: linear-gradient(145deg, rgba(255, 0, 170, 0.08), rgba(200, 0, 255, 0.04));
  border: 1px solid rgba(255, 0, 170, 0.25);
  border-radius: var(--r-md);
}

/* Si français uniquement, afficher la colonne FR */
#step5 .idea-header-bilingual.french-only .idea-header-fr {
  display: block !important;
  background: transparent;
  border: none;
  padding: 0;
}

#step5 .idea-header-bilingual.french-only .idea-header-lang {
  display: none !important;
}

/* Masquer le switch mobile - plus nécessaire */
.idea-switch {
  display: none !important;
}

/* Labels - afficher uniquement la langue choisie */
#step5 .bilingual-label {
  display: block; /* Plus de flex côte à côte */
  margin: 22px 0 10px;
}

#step5 .bilingual-label .label-fr {
  display: none !important;
}

#step5 .bilingual-label .label-lang {
  display: block;
  flex: none;
}

/* Si français uniquement */
#step5.french-only .bilingual-label .label-fr {
  display: block !important;
}

#step5.french-only .bilingual-label .label-lang {
  display: none !important;
}

/* Textes bilingues dans les checkboxes/boutons - langue choisie uniquement */
#step5 .bilingual-text {
  display: block;
}

#step5 .bilingual-text .text-fr {
  display: none !important;
}

#step5 .bilingual-text .text-lang {
  display: inline;
  color: var(--ink); /* Même couleur que le texte normal */
  font-size: 1em;
}

/* Si français uniquement */
#step5.french-only .bilingual-text .text-fr {
  display: inline !important;
}

#step5.french-only .bilingual-text .text-lang {
  display: none !important;
}

/* Radio items - texte sur une seule ligne */
#step5 .radio-item .bilingual-text {
  flex-direction: row;
  gap: 0;
}

#step5 .radio-item .bilingual-text .text-lang::after {
  display: none; /* Pas de séparateur "/" */
}

/* ============================================================
   RESPONSIVE - Même comportement sur mobile
   ============================================================ */

@media (max-width: 1000px) {
  #step5 .idea-header-bilingual {
    display: block;
  }
  
  #step5 .idea-header-lang,
  #step5 .idea-header-fr {
    /* Même règles que desktop */
  }
  
  #step5 .bilingual-label {
    flex-direction: column;
    gap: 0;
  }
}

/* ============================================================
   STEP 5 - MODE VOCAL : Masquer les champs de saisie texte
   
   Quand l'utilisateur a choisi le mode vocal, on cache :
   - Le type de contribution (checkboxes)
   - Le titre de l'idée
   - La description
   - L'impact
   
   On garde uniquement :
   - L'en-tête
   - L'enregistrement vocal
   - Les illustrations (photos/vidéos)
   - L'aperçu de la transcription
   ============================================================ */

/* Mode vocal activé sur step5 */
#step5.voice-mode .field-group[data-field="type"],
#step5.voice-mode .field-group[data-field="title"],
#step5.voice-mode .field-group[data-field="description"],
#step5.voice-mode .field-group[data-field="impact"] {
  display: none !important;
}

/* Alternative : cibler par les IDs des éléments */
#step5.voice-mode .choice-row:has(input[name="shareType"]) {
  display: none !important;
}

/* Masquer les labels bilingues pour type, titre, description, impact */
#step5.voice-mode #labelTypeLang,
#step5.voice-mode #labelIdeaTitleLang,
#step5.voice-mode #labelDescriptionLang,
#step5.voice-mode #labelImpactLang,
#step5.voice-mode .label-fr[for="ideaTitle"],
#step5.voice-mode .label-fr[for="typedText"],
#step5.voice-mode .label-fr[for="impactSelect"] {
  display: none !important;
}

/* Masquer les inputs correspondants */
#step5.voice-mode #ideaTitle,
#step5.voice-mode #typedText,
#step5.voice-mode #impactSelect,
#step5.voice-mode #impactOtherRow {
  display: none !important;
}

/* Masquer le parent .field-group qui contient ces éléments */
#step5.voice-mode .field-group:has(#ideaTitle),
#step5.voice-mode .field-group:has(#typedText),
#step5.voice-mode .field-group:has(#impactSelect),
#step5.voice-mode .field-group:has(.choice-row) {
  display: none !important;
}

/* ============================================================
   FALLBACK pour navigateurs sans support :has()
   On utilise des classes JS à la place
   ============================================================ */

#step5.voice-mode .field-group.hide-voice-mode {
  display: none !important;
}

/* ============================================================
   Style de l'en-tête en mode vocal - plus compact
   ============================================================ */

#step5.voice-mode .idea-header-bilingual,
#step5.voice-mode .idea-header-lang,
#step5.voice-mode .idea-header-fr {
  margin-bottom: 24px;
}

/* Message explicatif pour le mode vocal */
#step5 .voice-mode-hint {
  display: none;
  padding: 16px 20px;
  margin-bottom: 24px;
  background: linear-gradient(135deg, rgba(255, 0, 170, 0.1), rgba(200, 0, 255, 0.05));
  border: 1px solid rgba(255, 0, 170, 0.3);
  border-left: 4px solid var(--bio-magenta);
  border-radius: 0 var(--r-md) var(--r-md) 0;
  color: var(--ink);
  font-size: 14px;
  line-height: 1.6;
}

#step5.voice-mode .voice-mode-hint {
  display: block;
}

#step5 .voice-mode-hint strong {
  color: var(--bio-magenta);
}

/* ============================================================
   Mise en page plus aérée en mode vocal
   ============================================================ */

#step5.voice-mode .panel:first-child {
  padding-top: 20px;
}

/* Boutons d'enregistrement plus proéminents en mode vocal */
#step5.voice-mode #recBtn {
  min-height: 60px;
  font-size: 16px;
  padding: 18px 28px;
}

#step5.voice-mode .actions {
  gap: 16px;
}

/* ============================================================
   STEP 5 - MODE TEXTE : Masquer les éléments vocaux
   
   Quand l'utilisateur a choisi le mode texte, on cache :
   - L'enregistrement vocal (boutons rec, upload, test son)
   - Le panneau aperçu & traduction
   
   On garde :
   - L'en-tête avec le robot (repositionné)
   - Le type de contribution
   - Le titre, description, impact
   - Les illustrations
   ============================================================ */

/* Masquer la section enregistrement vocal en mode texte */
#step5.text-mode .field-group:has(#recBtn),
#step5.text-mode .field-group.voice-recording-group {
  display: none !important;
}

/* Masquer le panneau aperçu & traduction en mode texte */
#step5.text-mode .panel-preview {
  display: none !important;
}

/* Fallback pour navigateurs sans :has() */
#step5.text-mode .field-group.hide-text-mode {
  display: none !important;
}

/* ============================================================
   ROBOT FLOTTANT DANS L'EN-TÊTE EN MODE TEXTE
   ============================================================ */

/* Container pour le robot dans l'en-tête */
#step5 .idea-header-robot {
  display: none;
  position: absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  width: 100px;
  height: 100px;
  pointer-events: none;
  z-index: 10;
}

#step5 .idea-header-robot img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 0 20px rgba(0, 255, 229, 0.3));
  animation: robot-float-mini 4s ease-in-out infinite;
}

@keyframes robot-float-mini {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* Afficher le robot flottant uniquement en mode texte */
#step5.text-mode .idea-header-robot {
  display: block;
}

/* Ajuster le padding de l'en-tête pour laisser place au robot */
#step5.text-mode .idea-header-bilingual {
  position: relative;
  padding-right: 110px;
}

#step5.text-mode .idea-header-lang,
#step5.text-mode .idea-header-fr {
  position: relative;
}

/* Mobile : robot plus petit */
@media (max-width: 768px) {
  #step5 .idea-header-robot {
    width: 70px;
    height: 70px;
    right: 0;
  }
  
  #step5.text-mode .idea-header-bilingual {
    padding-right: 80px;
  }
}

/* ============================================================
   AJUSTEMENTS DU LAYOUT EN MODE TEXTE
   ============================================================ */

/* Le contenu prend toute la largeur car pas de panneau aperçu */
#step5.text-mode .content {
  display: block;
}

#step5.text-mode .content > .panel:first-child {
  max-width: 900px;
  margin: 0 auto;
}

</style>


</head>
<body>
  <div class="backdrop"></div><div class="orb"></div><div class="orb2"></div>

<div class="wrap">
  <div class="hero">
    <div class="brand">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 12c0-4.418 3.582-8 8-8 3.582 0 6.613 2.347 7.643 5.6" stroke="url(#g1)" stroke-width="2" stroke-linecap="round"/>
        <path d="M20 12c0 4.418-3.582 8-8 8-3.582 0-6.613-2.347-7.643-5.6" stroke="url(#g2)" stroke-width="2" stroke-linecap="round"/>
        <defs>
          <linearGradient id="g1" x1="4" y1="4" x2="22" y2="12">
            <stop stop-color="#2b62ff"/><stop offset="1" stop-color="#00c9b7"/>
          </linearGradient>
          <linearGradient id="g2" x1="4" y1="12" x2="22" y2="22">
            <stop stop-color="#ff7ab6"/><stop offset="1" stop-color="#00c9b7"/>
          </linearGradient>
        </defs>
      </svg>
      <span class="badge">IDEA — Espace Innovation</span>
    </div>
  </div>

  <div class="ribbon">
    🚀 <b>Ton idée, notre avancée.</b> Partage en moins de 2 minutes, nous nous chargeons du reste.
  </div>

  <h1>Laisse ton idée briller ✨</h1>
  <p class="sub">
    Ici, tu peux partager en quelques instants une idée d’innovation, une proposition d’amélioration continue
    ou un retour terrain. Chaque contribution est analysée par l’équipe innovation IDEA.
  </p>

  <div class="card">
    <div class="card-head"></div>

    <!-- STEP 1 : ACCUEIL + CHOIX MODE -->
    <section id="step1" class="step-page active">
      <div class="intro-main">
        <!-- Colonne gauche : choix du mode -->
        <div class="intro-main-main">
          <h2>Comment veux-tu t’exprimer&nbsp;?</h2>
          <p class="intro-lead">
            Choisis si tu préfères <b>écrire</b> ou <b>parler</b> ton idée.
            On te posera ensuite les questions étape par étape, sans tout demander d’un coup.
          </p>

          <div class="intro-actions">
            <button type="button"
                    id="btnModeText"
                    class="btn-primary">
              ✍️ Je préfère écrire
            </button>

            <button type="button"
                    id="btnModeVoice"
                    class="btn-ghost">
              🎙️ Je préfère parler
            </button>
          </div>

          <p id="modeHint" class="muted small"></p>

          <!-- reCAPTCHA affiché uniquement après le choix -->
          <div id="captchaRow" style="display:none; margin-top:18px;">
            <div class="g-recaptcha"
                 data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"
                 data-callback="onCaptchaSuccess">
            </div>
            <p class="muted small" style="margin-top:8px;">
              Cette étape sert uniquement à sécuriser la plateforme.
              Après validation, nous t’emmenons directement vers l’étape suivante.
            </p>
          </div>
        </div>

        <!-- Colonne droite : explication légère -->
        <aside class="intro-main-side">
          <h3>Ce que tu peux partager</h3>
          <p>En moins de <b>2 minutes</b>, tu peux nous envoyer :</p>
          <ul class="intro-mini-list">
            <li>
              <span class="pill">1</span>
              <span>Une idée d’innovation produit, service ou usage client.</span>
            </li>
            <li>
              <span class="pill">2</span>
              <span>Une amélioration sur un process, un outil, un flux.</span>
            </li>
            <li>
              <span class="pill">3</span>
              <span>Un problème terrain observé au quotidien.</span>
            </li>
          </ul>
          <p style="margin-top:10px;" class="muted small">
            L’équipe IDEA analyse chaque contribution.
          </p>
        </aside>
      </div>
    </section>

    <!-- STEP 3 : PROFIL TEXTE (BILINGUE) -->
<section id="step3" class="step-page">
  <div class="panel">
    <!-- Switch mobile pour basculer entre les langues -->
    <div class="profile-switch" id="profileSwitch" style="display:none;">
      <span id="profileSwitchLabel" class="voice-switch-label">Langue choisie</span>
      <button type="button" id="profileSwitchBtn" class="voice-switch-btn"
              aria-label="Basculer entre la langue choisie et le français">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 8h11.17l-2.88-2.88a1 1 0 1 1 1.42-1.42l4.59 4.6a1 1 0 0 1 0 1.4l-4.59 4.6a1 1 0 0 1-1.42-1.42L16.17 10H5a1 1 0 0 1 0-2Zm14 8H7.83l2.88 2.88a1 1 0 0 1-1.42 1.42L4.7 15.7a1 1 0 0 1 0-1.4l4.59-4.6a1 1 0 1 1 1.42 1.42L7.83 14H19a1 1 0 0 1 0 2Z"
                fill="currentColor"/>
        </svg>
      </button>
    </div>

    <div class="profile-bilingual-grid" id="profileBilingualGrid">
      <!-- Colonne langue choisie -->
      <div class="voice-col voice-col--lang" id="profileLangCol">
        <h3 id="profileLangTitle">On démarre par toi</h3>
        <p class="muted" id="profileLangIntro">
          Avant de commencer, indique simplement <b>qui tu es</b>, <b>où tu travailles</b> et <b>quel est ton rôle</b>.
        </p>

        <label id="labelNameLang" for="authorNameLang">Nom et prénom</label>
        <input id="authorNameLang" placeholder="Ex : Marie Dupont" />

        <label id="labelSiteLang" for="countryLang">Sur quel site travailles-tu ?</label>
        <select id="countryLang">
          <option value="">Sélectionne ton site</option>
          <!-- Options injectées dynamiquement -->
        </select>
        <div id="otherSiteRowLang" style="display:none; margin-top:8px;">
          <input id="otherSiteLang" placeholder="Indique ton site" />
        </div>

        <label id="labelServiceLang" for="serviceSelectLang">Dans quel service travailles-tu ?</label>
        <select id="serviceSelectLang">
          <option value="">Sélectionne ton service</option>
          <!-- Options injectées dynamiquement -->
        </select>
        <div id="otherServiceRowLang" style="display:none; margin-top:8px;">
          <input id="otherServiceLang" placeholder="Précise ton service" />
        </div>

        <label id="labelFunctionLang" for="functionFieldLang">Quelle est ta fonction ?</label>
        <input id="functionFieldLang" placeholder="Ex : Technicien de maintenance, Responsable magasin…" />
      </div>

      <!-- Colonne FR -->
      <div class="voice-col voice-col--fr" id="profileFrCol">
        <h3>On démarre par toi</h3>
        <p class="muted">
          Avant de commencer, indique simplement <b>qui tu es</b>, <b>où tu travailles</b> et <b>quel est ton rôle</b>.
        </p>

        <label for="authorName">Nom et prénom</label>
        <input id="authorName" placeholder="Ex : Marie Dupont" />

        <label for="country">Sur quel site travailles-tu ?</label>
        <select id="country">
          <option value="">Sélectionne ton site</option>
          <option>Auxerre</option><option>Beaumont</option><option>Béziers</option>
          <option>Berre-l'Étang</option><option>Boulogne-Billancourt (Siège social)</option>
          <option>CAP Tunis</option><option>CAWE</option><option>Cagny</option>
          <option>Carpiquet</option><option>Chavagnes</option><option>Chambéry</option>
          <option>Cléguer</option><option>Colmar</option><option>Corbas</option>
          <option>Dammarie-lès-Lys</option><option>Douvrin</option><option>Firminy</option>
          <option>Fontaine-le-Comte</option><option>Gravigy</option><option>Guipavas</option>
          <option>Heillecourt</option><option>La Bresse</option><option>Lailly-en-Val</option>
          <option>Le Lude</option><option>Les Clayes-sous-Bois</option><option>Longvic</option>
          <option>Magasin central</option><option>Neuilly-sur-Marne</option><option>Nice</option>
          <option>Orthez</option><option>Pont-Sainte-Maxence</option><option>Porte-lès-Valence</option>
          <option>Reims</option><option>Rennes</option><option>Sainte-Luce-sur-Loire</option>
          <option>Saint-Sulpice</option><option>Toulouse</option><option>Villejust</option>
          <option value="Autre">Autre (préciser)</option>
        </select>
        <div id="otherSiteRow" style="display:none; margin-top:8px;">
          <input id="otherSite" placeholder="Indique ton site" />
          <div class="field-note">Si ton site n'apparaît pas dans la liste, précise-le ici.</div>
        </div>

        <label for="serviceSelect">Dans quel service travailles-tu ?</label>
        <select id="serviceSelect">
          <option value="">Sélectionne ton service</option>
          <option>Production</option>
          <option>Maintenance</option>
          <option>Distribution</option>
          <option>Relation client</option>
          <option>Commerce</option>
          <option>Administratif</option>
          <option>Support (achats, finance, HSE, RH…)</option>
          <option value="Autre">Autre (préciser)</option>
        </select>
        <div id="otherServiceRow" style="display:none; margin-top:8px;">
          <input id="otherService" placeholder="Précise ton service" />
        </div>

        <label for="functionField">Quelle est ta fonction ?</label>
        <input id="functionField" placeholder="Ex : Technicien de maintenance, Responsable magasin…" />
      </div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn-secondary" id="backToIntro">◀ Précédent</button>
      <button type="button" class="btn-primary" id="nextFromProfile">Suivant · Coordonnées</button>
    </div>
  </div>
</section>

    <!-- STEP 4 : COORDONNÉES (BILINGUE) -->
<section id="step4" class="step-page">
  <div class="panel">
    <h3 id="step4Title">Comment te recontacter ?</h3>

    <!-- Switch mobile pour basculer entre les langues -->
    <div class="contact-switch" id="contactSwitch" style="display:none;">
      <span id="contactSwitchLabel" class="voice-switch-label">Langue choisie</span>
      <button type="button" id="contactSwitchBtn" class="voice-switch-btn"
              aria-label="Basculer entre la langue choisie et le français">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 8h11.17l-2.88-2.88a1 1 0 1 1 1.42-1.42l4.59 4.6a1 1 0 0 1 0 1.4l-4.59 4.6a1 1 0 0 1-1.42-1.42L16.17 10H5a1 1 0 0 1 0-2Zm14 8H7.83l2.88 2.88a1 1 0 0 1-1.42 1.42L4.7 15.7a1 1 0 0 1 0-1.4l4.59-4.6a1 1 0 1 1 1.42 1.42L7.83 14H19a1 1 0 0 1 0 2Z"
                fill="currentColor"/>
        </svg>
      </button>
    </div>

    <div class="contact-bilingual-grid" id="contactBilingualGrid">
      <!-- Colonne langue choisie -->
      <div class="voice-col voice-col--lang" id="contactLangCol">
        <div class="contact-layout-inner">
          <div>
            <div class="section-label" id="sectionLabelCoordsLang">Coordonnées</div>
            <div class="contact-block">
              <div class="contact-block-title" id="contactBlockTitleEmailLang">Adresse mail professionnelle</div>
              <label id="labelProEmailLang" for="proEmailLang" style="margin-top:4px;">Si tu as une adresse mail professionnelle, note-la ci-dessous</label>
              <input id="proEmailLang" type="email" placeholder="Ex : prenom.nom@entreprise.com" />
              <div class="field-note" id="fieldNoteEmailLang">Ce champ est facultatif, mais il facilite le suivi de ton idée.</div>
            </div>
          </div>

          <div>
            <div class="section-label" id="sectionLabelPrefLang">Préférence de contact</div>
            <div class="contact-block">
              <div class="contact-block-title" id="contactBlockTitlePrefLang">Comment souhaites-tu être recontacté(e) ?</div>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="contactModeLang" value="Mail professionnel">
                  <span id="radioMailLang">Mail professionnel</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="contactModeLang" value="Par l'intermédiaire de mon responsable">
                  <span id="radioManagerLang">Par l'intermédiaire de mon responsable</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Colonne FR -->
      <div class="voice-col voice-col--fr" id="contactFrCol">
        <div class="contact-layout-inner">
          <div>
            <div class="section-label">Coordonnées</div>
            <div class="contact-block">
              <div class="contact-block-title">Adresse mail professionnelle</div>
              <label for="proEmail" style="margin-top:4px;">Si tu as une adresse mail professionnelle, note-la ci-dessous</label>
              <input id="proEmail" type="email" placeholder="Ex : prenom.nom@entreprise.com" />
              <div class="field-note">Ce champ est facultatif, mais il facilite le suivi de ton idée.</div>
            </div>
          </div>

          <div>
            <div class="section-label">Préférence de contact</div>
            <div class="contact-block">
              <div class="contact-block-title">Comment souhaites-tu être recontacté(e) ?</div>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="contactMode" value="Mail professionnel">
                  <span>Mail professionnel</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="contactMode" value="Par l'intermédiaire de mon responsable">
                  <span>Par l'intermédiaire de mon responsable</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn-secondary" id="backToProfile">◀ Précédent</button>
      <button type="button" class="btn-primary" id="nextFromContact">Suivant · Rédiger mon idée</button>
    </div>
  </div>
</section>

   <!-- STEP 5 : IDÉE (BILINGUE - VERSION OPTIMISÉE) -->
<section id="step5" class="step-page">
  <div class="content">
    <!-- PANNEAU PRINCIPAL : FORMULAIRE -->
    <div class="panel">
      <!-- En-tête bilingue -->
      <div class="idea-header-bilingual" id="ideaHeaderBilingual">
        <!-- Robot flottant pour mode texte -->
        <div class="idea-header-robot">
          <img src="/static/cawe_robot.png" alt="Robot IDEA">
        </div>
        <div class="idea-header-lang" id="ideaHeaderLang">
          <h3 id="ideaPanelTitleLang">Contenu de ton idée</h3>
          <p class="muted small" id="ideaPanelIntroLang">
            Quelques éléments suffisent : l'objectif est de comprendre ton contexte, ton besoin et l'impact attendu.
          </p>
        </div>
        <div class="idea-header-fr" id="ideaHeaderFr">
          <h3>Contenu de ton idée</h3>
          <p class="muted small">
            Quelques éléments suffisent : l'objectif est de comprendre ton contexte, ton besoin et l'impact attendu.
          </p>
        </div>
      </div>

      <!-- Switch mobile -->
      <div class="idea-switch" id="ideaSwitch" style="display:none;">
        <span id="ideaSwitchLabel" class="voice-switch-label">Langue choisie</span>
        <button type="button" id="ideaSwitchBtn" class="voice-switch-btn"
                aria-label="Basculer entre la langue choisie et le français">
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 8h11.17l-2.88-2.88a1 1 0 1 1 1.42-1.42l4.59 4.6a1 1 0 0 1 0 1.4l-4.59 4.6a1 1 0 0 1-1.42-1.42L16.17 10H5a1 1 0 0 1 0-2Zm14 8H7.83l2.88 2.88a1 1 0 0 1-1.42 1.42L4.7 15.7a1 1 0 0 1 0-1.4l4.59-4.6a1 1 0 1 1 1.42 1.42L7.83 14H19a1 1 0 0 1 0 2Z"
                  fill="currentColor"/>
          </svg>
        </button>
      </div>

      <!-- TYPE DE CONTRIBUTION -->
      <div class="field-group">
        <div class="bilingual-label">
          <span class="section-label label-lang" id="labelTypeLang">Type de contribution</span>
          <span class="section-label label-fr">Type de contribution</span>
        </div>
        <div class="choice-row">
          <label class="radio-item">
            <input type="checkbox" name="shareType" value="Difficulté">
            <span class="bilingual-text">
              <span class="text-lang" id="checkDifficultyLang">Une difficulté</span>
              <span class="text-fr">Une difficulté</span>
            </span>
          </label>
          <label class="radio-item">
            <input type="checkbox" name="shareType" value="Amélioration">
            <span class="bilingual-text">
              <span class="text-lang" id="checkImprovementLang">Une amélioration</span>
              <span class="text-fr">Une amélioration</span>
            </span>
          </label>
          <label class="radio-item">
            <input type="checkbox" name="shareType" value="Innovation">
            <span class="bilingual-text">
              <span class="text-lang" id="checkInnovationLang">Une innovation</span>
              <span class="text-fr">Une innovation</span>
            </span>
          </label>
        </div>
      </div>

      <!-- TITRE DE L'IDÉE -->
      <div class="field-group">
        <div class="bilingual-label">
          <label class="label-lang" id="labelIdeaTitleLang" for="ideaTitle">Titre de ton IDEA</label>
          <label class="label-fr" for="ideaTitle">Titre de ton IDEA</label>
        </div>
        <input id="ideaTitle" placeholder="Ex : Photo réforme" data-placeholder-lang="Ex : Photo réforme" />
      </div>

      <!-- DESCRIPTION -->
      <div class="field-group">
        <div class="bilingual-label">
          <label class="label-lang" id="labelDescriptionLang" for="typedText">Description (optionnel si audio)</label>
          <label class="label-fr" for="typedText">Description (optionnel si audio)</label>
        </div>
        <textarea id="typedText" placeholder="Décris ton idée, ton besoin, ton insight…" data-placeholder-lang="Décris ton idée, ton besoin, ton insight…"></textarea>
      </div>

      <!-- IMPACT -->
      <div class="field-group">
        <div class="bilingual-label">
          <label class="label-lang" id="labelImpactLang" for="impactSelect">Quel impact principal aurait ton idée ?</label>
          <label class="label-fr" for="impactSelect">Quel impact principal aurait ton idée ?</label>
        </div>
        <select id="impactSelect">
          <option value="" data-lang="">Sélectionne l'impact principal</option>
          <option value="Condition de travail / Ergonomie" data-lang="">Condition de travail / Ergonomie</option>
          <option value="Développement durable / Environnement" data-lang="">Développement durable / Environnement</option>
          <option value="Gain de temps / Efficacité" data-lang="">Gain de temps / Efficacité</option>
          <option value="Productivité" data-lang="">Productivité</option>
          <option value="Économie d'énergie" data-lang="">Économie d'énergie</option>
          <option value="Sécurité" data-lang="">Sécurité</option>
          <option value="Autre" data-lang="">Autre (préciser)</option>
        </select>

        <div id="impactOtherRow" style="display:none; margin-top:8px;">
          <input id="impactOther" placeholder="Précise l'impact" data-placeholder-lang="Précise l'impact" />
        </div>
      </div>

      <!-- ENREGISTREMENT VOCAL -->
      <div class="field-group voice-recording-group">
        <div class="bilingual-label">
          <span class="section-label label-lang" id="labelRecordingLang">Enregistrement vocal</span>
          <span class="section-label label-fr">Enregistrement vocal</span>
        </div>
        <div class="actions">
          <button id="recBtn" class="btn-primary" data-tip="HTTPS requis (ou localhost)">
            <span class="bilingual-text">
              <span class="text-lang" id="btnRecLang">🎙️ Démarrer l'enregistrement</span>
              <span class="text-fr">🎙️ Démarrer l'enregistrement</span>
            </span>
          </button>
          <button id="uploadBtn" class="btn-ghost">
            <span class="bilingual-text">
              <span class="text-lang" id="btnUploadLang">📁 Importer un audio</span>
              <span class="text-fr">📁 Importer un audio</span>
            </span>
          </button>
          <button id="toneBtn" class="btn-ghost" data-tip="Petit bip de test">
            <span class="bilingual-text">
              <span class="text-lang" id="btnToneLang">🔊 Tester le son</span>
              <span class="text-fr">🔊 Tester le son</span>
            </span>
          </button>
          <input id="audioFile" type="file" accept="audio/*" capture style="display:none" />
        </div>
        <audio id="player" controls hidden></audio>
      </div>

      <!-- ILLUSTRATIONS -->
      <div class="field-group">
        <div class="bilingual-label">
          <span class="section-label label-lang" id="labelMediaLang">Illustrations (facultatif)</span>
          <span class="section-label label-fr">Illustrations (facultatif)</span>
        </div>
        <div class="bilingual-label" style="margin-top:4px;">
          <label class="label-lang" id="labelPhotosLang">Photos / vidéos</label>
          <label class="label-fr">Photos / vidéos</label>
        </div>
        <div class="actions">
          <button type="button" class="btn-ghost" id="mediaCaptureBtn">
            <span class="bilingual-text">
              <span class="text-lang" id="btnCaptureLang">📷 Prendre une photo / vidéo</span>
              <span class="text-fr">📷 Prendre une photo / vidéo</span>
            </span>
          </button>
          <button type="button" class="btn-ghost" id="mediaUploadBtn">
            <span class="bilingual-text">
              <span class="text-lang" id="btnMediaUploadLang">📁 Importer depuis ton appareil</span>
              <span class="text-fr">📁 Importer depuis ton appareil</span>
            </span>
          </button>
          <input id="mediaInputCamera" type="file"
                 accept="image/*,video/*" capture style="display:none" multiple>
          <input id="mediaInputFile" type="file"
                 accept="image/*,video/*" style="display:none" multiple>
        </div>
        <div id="mediaPreview" class="media-preview"></div>
      </div>

      <div class="nav-row">
        <button type="button" class="btn-secondary" id="backToContact">
          <span class="bilingual-text">
            <span class="text-lang" id="btnBackLang">◀ Précédent</span>
            <span class="text-fr">◀ Précédent</span>
          </span>
        </button>
      </div>
    </div>

    <!-- PANNEAU APERÇU -->
    <div class="panel panel-preview">
      <div class="preview-top">
        <div class="preview-text">
          <h3 id="previewTitleLang">Aperçu & traduction</h3>
          <p class="muted small" id="previewIntroLang">
            Ce panneau se mettra à jour dès que tu enregistres ou importes un audio. Tu peux vérifier le texte compris
            avant d'envoyer ton IDEA.
          </p>
        </div>
        <div class="preview-robot">
          <img src="/static/cawe_robot.png" alt="Robot IDEA">
        </div>
      </div>

      <div class="preview-grid">
        <div>
          <strong id="previewOrigLabelLang">🗣️ Texte d'origine</strong>
          <div class="muted" id="langChip" style="margin:6px 0 10px"></div>
          <div id="origBox" class="preview-box">—</div>
        </div>
        <div>
          <strong id="previewFrLabelLang">🇫🇷 Traduction française</strong>
          <div id="frBox" class="preview-box">—</div>
        </div>
      </div>

      <div class="helper">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2a10 10 0 100 20 10 10 0 000-20Zm1 14h-2v-2h2v2Zm0-4h-2V6h2v6Z" fill="#3a66ff"/>
        </svg>
        <div class="muted" id="helperTextLang">
          Vérifie rapidement : tu pourras ensuite finaliser et envoyer ton idée. En cas d'erreur,
          tu pourras corriger le texte ou refaire un enregistrement.
        </div>
      </div>
    </div>
  </div>
</section>

    <!-- STEP 6 : PROFIL PAR LA VOIX (LANGUE + BILINGUE) -->
    <section id="stepVoice" class="step-page">
      <div class="voice-shell">
        <!-- Robot au centre, en transparence -->
        <div class="voice-bg">
          <img src="/static/cawe_robot.png" alt="Robot IDEA">
        </div>

        <div class="voice-foreground">
          <!-- Étape 0 : détection de la langue -->
          <div id="voiceLangCard" class="panel">
            <h3>Dans quelle langue veux-tu t’exprimer&nbsp;?</h3>
            <p class="muted">
              Dis une phrase comme <b>« Je préfère parler en espagnol »</b> ou
              <b>« I want to speak in English »</b>. Nous détectons la langue
              puis nous affichons les consignes dans cette langue, en plus du français.
            </p>

            <div class="actions" style="margin-top:14px; gap:10px; flex-wrap:wrap;">
              <button id="langRecBtn" class="btn-primary">
                🎙️ Dire ma langue
              </button>

              <!-- Choix manuel de la langue -->
              <select id="langSelect" class="lang-select">
                <option value="">Ou choisis ta langue…</option>
                <!-- Options injectées en JS -->
              </select>
            </div>

            <div style="margin-top:16px;">
              <strong>Texte reconnu</strong>
              <div id="langTextBox" class="preview-box" style="min-height:60px;">—</div>
            </div>

            <div id="langDetectedRow" class="muted" style="margin-top:10px;"></div>

            <!-- Confirmation X / ✔ -->
            <div id="langConfirmRow"
                 style="display:none; margin-top:14px; align-items:center; gap:12px;">
              <span id="langConfirmLabel" class="muted"></span>
              <div style="display:flex; gap:8px;">
                <button type="button" id="langConfirmNo"
                        style="width:40px; height:40px; border-radius:999px; border:0;
                               background:#ffe5e5; color:#c62828; font-size:20px;">
                  ✖
                </button>
                <button type="button" id="langConfirmYes"
                        style="width:40px; height:40px; border-radius:999px; border:0;
                               background:#e1f7e4; color:#2e7d32; font-size:20px;">
                  ✔
                </button>
              </div>
            </div>
          </div>

          <!-- Étape 1 : cartes bilingues + enregistrement profil -->
          <div id="voiceProfileCard" class="panel" style="display:none;">
            <!-- Switch simple pour mobile -->
            <div class="voice-switch" id="voiceSwitch">
              <span id="voiceSwitchLabel" class="voice-switch-label">Langue choisie</span>
              <button type="button" id="voiceSwitchBtn" class="voice-switch-btn"
                      aria-label="Basculer entre la langue choisie et le français">
                <!-- Icône deux flèches -->
                <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M5 8h11.17l-2.88-2.88a1 1 0 1 1 1.42-1.42l4.59 4.6a1 1 0 0 1 0 1.4l-4.59 4.6a1 1 0 0 1-1.42-1.42L16.17 10H5a1 1 0 0 1 0-2Zm14 8H7.83l2.88 2.88a1 1 0 0 1-1.42 1.42L4.7 15.7a1 1 0 0 1 0-1.4l4.59-4.6a1 1 0 1 1 1.42 1.42L7.83 14H19a1 1 0 0 1 0 2Z"
                        fill="currentColor"/>
                </svg>
              </button>
            </div>

            <div class="profile-bilingual-grid">
              <!-- Colonne langue choisie -->
              <div class="voice-col voice-col--lang" id="voiceLangCol">
                <h3 id="voiceLangTitle">Preséntese verbalmente</h3>
                <p class="muted" id="voiceLangIntro">
                  En esta grabación, simplemente diga:
                </p>
                <ul id="voiceLangList">
                  <li><span class="pill">1</span><span>Su nombre y apellido.</span></li>
                  <li><span class="pill">2</span><span>El lugar donde trabaja.</span></li>
                  <li><span class="pill">3</span><span>Su departamento.</span></li>
                  <li><span class="pill">4</span><span>Su cargo.</span></li>
                </ul>

                <div class="actions">
                  <button id="profileRecBtnMirror" class="btn-primary">
                    🎙️ Iniciar grabación
                  </button>
                  <button id="profileUploadBtnMirror" class="btn-ghost">
                    📁 Subir audio
                  </button>
                </div>

                <p class="notice" id="voiceLangNotice">
                  🔒 Su audio se utiliza únicamente para generar el texto a continuación.
                  Nadie más lo guarda ni lo escucha.
                </p>
              </div>

              <!-- Colonne FR -->
              <div class="voice-col voice-col--fr" id="voiceFrCol">
                <h3>Présente-toi à l’oral</h3>
                <p class="muted">Dans cet enregistrement, indique simplement :</p>
                <ul>
                  <li><span class="pill">1</span><span>Ton <b>nom et prénom</b>.</span></li>
                  <li><span class="pill">2</span><span>Le <b>site</b> sur lequel tu travailles.</span></li>
                  <li><span class="pill">3</span><span>Ton <b>service</b>.</span></li>
                  <li><span class="pill">4</span><span>Ta <b>fonction</b> (poste occupé).</span></li>
                </ul>

                <div class="actions">
                  <button id="profileRecBtn" class="btn-primary">
                    🎙️ Démarrer l’enregistrement
                  </button>
                  <button id="profileUploadBtn" class="btn-ghost">
                    📁 Importer un audio
                  </button>
                  <input id="profileAudioFile" type="file" accept="audio/*" capture style="display:none">
                </div>

                <audio id="profilePlayer" controls hidden style="margin-top:10px;"></audio>

                <p class="notice">
                  🔒 Ton audio est utilisé uniquement pour générer le texte ci-dessous.
                  Il n’est ni conservé, ni réécouté par une autre personne.
                </p>
              </div>
            </div>

            <!-- Prévisualisation texte / traduction -->
            <div class="voice-preview-block">
              <div>
                <strong>🗣️ Texte d’origine</strong>
                <div class="muted" id="profileLangChip" style="margin:6px 0 10px;"></div>
                <div id="profileOrigBox" class="preview-box">—</div>
              </div>
              <div>
                <strong>🇫🇷 Traduction française</strong>
                <div id="profileFrBox" class="preview-box">—</div>
              </div>
            </div>

            <div id="voiceMissingMsg"
                 class="muted"
                 style="color:#c62828; margin-top:14px; font-weight:600;"></div>

            <div class="nav-row" style="margin-top:20px;">
              <button type="button" class="btn-secondary" id="backToModeVoice">
                ◀ Retour
              </button>
              <button type="button" class="btn-primary" id="nextFromVoice">
                Suivant · Vérifier mes infos
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- STEP MERCI : CONFIRMATION FINALE -->
    <section id="stepThanks" class="step-page">
      <div class="panel thank-panel">
        <div class="thank-layout">
          <div class="thank-text">
            <h2>Merci pour ton IDEA 💡</h2>
            <p class="muted">
              Toute l’équipe <b>IDEA</b> te remercie chaleureusement pour ta contribution.
              Grâce à des personnes comme toi, nous continuons à nous améliorer
              chaque jour, chaque heure, chaque minute.
            </p>
            <p class="muted">
              Ton IDEA va maintenant être analysée par l’équipe innovation.
              Si un suivi est nécessaire, nous te recontacterons via le mode que tu as choisi.
            </p>
            <div class="thank-highlight">
              <span>✨ Sans idées, il n’y a pas de progrès. Merci d’avoir pris le temps de partager la tienne.</span>
            </div>

            <button type="button" class="btn-secondary" id="backToHomeBtn">
              ⬅️ Retour à l’accueil IDEA
            </button>
          </div>

          <div class="thank-robot">
            <div class="thank-robot-orbit">
              <img src="/static/cawe_robot.png" alt="Robot IDEA qui te remercie">
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <div class="spacer"></div>
</div>

<div class="submitbar">
  <div class="inner">
    <button id="submitBtn" class="btn-primary" disabled>
      ✅ Soumettre mon idée
    </button>
    <span id="statusMsg" class="muted"></span>
  </div>
</div>


  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script>
// --- Navigation entre étapes ---

const stepPages = Array.from(document.querySelectorAll(".step-page"));
let currentStepId = "step1";
const recState = document.getElementById("recState"); // optionnel

function showStep(id){
  currentStepId = id;
  stepPages.forEach(p => p.classList.toggle("active", p.id === id));

  if (recState){
    const labels = {
      step1: "Introduction",
      step3: "Profil collaborateur",
      step4: "Coordonnées",
      step5: "Saisie de l’idée",
      stepVoice: "Profil vocal",
      stepThanks: "Confirmation"
    };
    recState.textContent = labels[id] || "";
  }
  window.scrollTo({ top: 0, behavior: "smooth" });
}

document.addEventListener("DOMContentLoaded", () => {
  showStep("step1");
});

// --- Accueil : choix du mode + reCAPTCHA ---

const btnModeText  = document.getElementById("btnModeText");
const btnModeVoice = document.getElementById("btnModeVoice");
const modeHint     = document.getElementById("modeHint");
const captchaRow   = document.getElementById("captchaRow");

let chosenMode = null;
let captchaOk  = false;

function updateModeButtons(){
  if (!btnModeText || !btnModeVoice) return;
  if (chosenMode === "text"){
    btnModeText.classList.add("btn-primary");
    btnModeText.classList.remove("btn-ghost");
    btnModeVoice.classList.add("btn-ghost");
    btnModeVoice.classList.remove("btn-primary");
  } else if (chosenMode === "voice"){
    btnModeVoice.classList.add("btn-primary");
    btnModeVoice.classList.remove("btn-ghost");
    btnModeText.classList.add("btn-ghost");
    btnModeText.classList.remove("btn-primary");
  }
}

function handleModeChoice(mode){
  chosenMode = mode;
  updateModeButtons();

   if (mode === "voice") {
    setStep5VoiceMode();
  } else {
    setStep5TextMode();
  }
  if (captchaRow) captchaRow.style.display = "block";

  if (modeHint){
    if (mode === "text"){
      modeHint.textContent =
        "Valide le « Je ne suis pas un robot » pour commencer par ton profil en mode texte.";
    } else {
      modeHint.textContent =
        "Valide le « Je ne suis pas un robot » pour commencer par ton profil en mode vocal.";
    }
  }
}

btnModeText?.addEventListener("click", () => handleModeChoice("text"));
btnModeVoice?.addEventListener("click", () => handleModeChoice("voice"));

function onCaptchaSuccess(){
  captchaOk = true;
  if (!chosenMode){
    if (modeHint){
      modeHint.textContent =
        "Merci, choisis d'abord si tu préfères écrire ou parler ton idée.";
    }
    return;
  }
  
  // AJOUTER CES LIGNES :
  if (chosenMode === "voice") {
    setStep5VoiceMode();
  } else {
    setStep5TextMode();
  }
  
  if (chosenMode === "text"){
    showStep("step3");
  } else {
    showStep("stepVoice");
  }
}
window.onCaptchaSuccess = onCaptchaSuccess;

// --- Champs profil / coordonnées / idée ---

const siteSelect        = document.getElementById("country");
const otherSiteRow      = document.getElementById("otherSiteRow");
const otherSite         = document.getElementById("otherSite");
const serviceSelect     = document.getElementById("serviceSelect");
const otherServiceRow   = document.getElementById("otherServiceRow");
const otherService      = document.getElementById("otherService");
const proEmail          = document.getElementById("proEmail");
const authorName        = document.getElementById("authorName");
const functionField     = document.getElementById("functionField");
const submitBtn         = document.getElementById("submitBtn");
const statusMsg         = document.getElementById("statusMsg");

siteSelect?.addEventListener("change", () => {
  if (!otherSiteRow || !otherSite) return;
  otherSiteRow.style.display = siteSelect.value === "Autre" ? "block" : "none";
  if (siteSelect.value !== "Autre") otherSite.value = "";
});

serviceSelect?.addEventListener("change", () => {
  if (!otherServiceRow || !otherService) return;
  otherServiceRow.style.display = serviceSelect.value === "Autre" ? "block" : "none";
  if (serviceSelect.value !== "Autre") otherService.value = "";
});

function getContactMode(){
  const checked = document.querySelector("input[name='contactMode']:checked");
  return checked ? checked.value : null;
}

// --- Impact ---

const impactSelect   = document.getElementById("impactSelect");
const impactOtherRow = document.getElementById("impactOtherRow");
const impactOther    = document.getElementById("impactOther");

function getImpact(){
  const v = impactSelect.value;
  if (!v) return { impact: null, impact_other: null };

  if (v === "Autre") {
    return { impact: "Autre", impact_other: impactOther.value || null };
  }
  return { impact: v, impact_other: null };
}

impactSelect?.addEventListener("change", () => {
  if (!impactOtherRow || !impactOther) return;
  if (impactSelect.value === "Autre"){
    impactOtherRow.style.display = "block";
    impactOther.value = "";
  } else {
    impactOtherRow.style.display = "none";
    impactOther.value = "";
  }
});

// --- Audio / transcription de l’idée ---

const recBtn     = document.getElementById("recBtn");
const uploadBtn  = document.getElementById("uploadBtn");
const toneBtn    = document.getElementById("toneBtn");
const audioFile  = document.getElementById("audioFile");
const player     = document.getElementById("player");
const typedText  = document.getElementById("typedText");
const langChip   = document.getElementById("langChip");
const origBox    = document.getElementById("origBox");
const frBox      = document.getElementById("frBox");

const mediaCaptureBtn = document.getElementById("mediaCaptureBtn");
const mediaUploadBtn  = document.getElementById("mediaUploadBtn");
const mediaInputCamera= document.getElementById("mediaInputCamera");
const mediaInputFile  = document.getElementById("mediaInputFile");
const mediaPreview    = document.getElementById("mediaPreview");

let mediaFiles = [];
let mediaRecorder = null, chunks = [], stream;
let detectedLanguage = null, originalText = null, frenchTranslation = null;

function isSecure(){
  return window.isSecureContext || ["localhost","127.0.0.1"].includes(location.hostname);
}

function pickBestMime(){
  const candidates = ['audio/webm;codecs=opus','audio/webm','audio/mp4',''];
  for(const c of candidates){
    if(!c) return undefined;
    if(MediaRecorder.isTypeSupported(c)) return c;
  }
  return undefined;
}

toneBtn?.addEventListener("click", async ()=>{
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gn  = ctx.createGain();
  gn.gain.value = 0.2; osc.frequency.value = 880; osc.connect(gn); gn.connect(ctx.destination);
  osc.start(); setTimeout(()=>{ osc.stop(); ctx.close(); }, 600);
});

async function transcribeBlob(blob){
  if (statusMsg) statusMsg.textContent = "Transcription en cours…";
  const form = new FormData();
  form.append("audio", blob, "record.webm");
  const res = await fetch("/api/transcribe", { method: "POST", body: form });
  const data = await res.json();
  if (!res.ok || !data.ok){
    if (statusMsg) statusMsg.textContent = (data && data.error) ? data.error : "Échec de la transcription.";
    return;
  }
  detectedLanguage   = data.language || "";
  originalText       = data.original_text || "";
  frenchTranslation  = data.french_translation || "";

  if (langChip) langChip.textContent = detectedLanguage ? `Langue détectée : ${detectedLanguage}` : "";
  if (origBox)  origBox.textContent = originalText || "—";
  if (frBox)    frBox.textContent = frenchTranslation || "—";

  if (submitBtn) submitBtn.disabled = false;
  if (statusMsg) statusMsg.textContent = "Transcription terminée. Tu pourras envoyer à la dernière étape.";
}

async function startRecording(){
  if(!isSecure() || !(navigator.mediaDevices?.getUserMedia)){
    alert("HTTPS requis (ou localhost). Utilise plutôt l’import de fichier audio.");
    return;
  }
  try{
    try{ if(player && !player.paused) player.pause(); }catch(_){}
    if (player) player.hidden = true;
    if(stream) stream.getTracks().forEach(t=>t.stop());
    const constraints = { audio: { echoCancellation:true, noiseSuppression:true, autoGainControl:true, channelCount:1, sampleRate:48000, sampleSize:16 } };
    stream = await navigator.mediaDevices.getUserMedia(constraints);

    chunks = []; const mime = pickBestMime();
    mediaRecorder = new MediaRecorder(stream, mime ? { mimeType: mime } : undefined);
    mediaRecorder.ondataavailable = e => { if(e.data.size>0) chunks.push(e.data); };
    mediaRecorder.onstop = async () => {
      const blob = new Blob(chunks, { type: mediaRecorder.mimeType || "audio/webm" });
      if (player){
        player.src = URL.createObjectURL(blob);
        player.hidden = false;
      }
      await transcribeBlob(blob);
      if(stream) stream.getTracks().forEach(t=>t.stop());
    };

    mediaRecorder.start();
    if (recBtn) recBtn.textContent = "⏹️ Arrêter";
  }catch(err){
    alert("Impossible d'accéder au micro : " + err);
  }
}

function stopRecording(){
  if(mediaRecorder && mediaRecorder.state !== "inactive"){
    mediaRecorder.stop();
    if (recBtn) recBtn.textContent = "🎙️ Démarrer l’enregistrement";
  }
}

recBtn?.addEventListener("click", () => {
  (!mediaRecorder || mediaRecorder.state === "inactive") ? startRecording() : stopRecording();
});
uploadBtn?.addEventListener("click", () => audioFile?.click());
audioFile?.addEventListener("change", async () => {
  const file = audioFile.files?.[0]; if (!file) return;
  if (player){
    player.src = URL.createObjectURL(file);
    player.hidden = false;
  }
  await transcribeBlob(file);
});

function handleMediaFiles(fileList){
  mediaFiles = Array.from(fileList || []);
  if (!mediaPreview) return;
  mediaPreview.innerHTML = "";

  mediaFiles.forEach(file => {
    const url = URL.createObjectURL(file);
    const isVideo = file.type.startsWith("video/");
    const el = document.createElement(isVideo ? "video" : "img");
    el.src = url;
    if(isVideo){
      el.muted = true;
      el.controls = true;
    }
    mediaPreview.appendChild(el);
  });
}

mediaCaptureBtn?.addEventListener("click", () => mediaInputCamera?.click());
mediaInputCamera?.addEventListener("change", () => handleMediaFiles(mediaInputCamera.files));
mediaUploadBtn?.addEventListener("click", () => mediaInputFile?.click());
mediaInputFile?.addEventListener("change", () => handleMediaFiles(mediaInputFile.files));

function getShareTypes(){
  const boxes = document.querySelectorAll("input[name='shareType']:checked");
  return Array.from(boxes).map(b => b.value);
}

// --- PROFIL VOCAL (analyse + hints) ---

const profileRecBtn      = document.getElementById("profileRecBtn");
const profileUploadBtn   = document.getElementById("profileUploadBtn");
const profileAudioFile   = document.getElementById("profileAudioFile");
const profilePlayer      = document.getElementById("profilePlayer");
const profileLangChip    = document.getElementById("profileLangChip");
const profileOrigBox     = document.getElementById("profileOrigBox");
const profileFrBox       = document.getElementById("profileFrBox");
const voiceMissingMsg    = document.getElementById("voiceMissingMsg");

let profileMediaRecorder = null, profileChunks = [], profileStream;
let profileDetectedLanguage = null,
    profileOriginalText    = null,
    profileFrenchTranslation = null;

let profileReady = false;

let profileSlots = {
  name: null,
  site: null,
  service: null,
  function_title: null
};
let profileMissing = [];
let profileHints   = {};

const labelNameEl    = document.querySelector("label[for='authorName']");
const labelSiteEl    = document.querySelector("label[for='country']");
const labelServiceEl = document.querySelector("label[for='serviceSelect']");
const labelFuncEl    = document.querySelector("label[for='functionField']");

const baseLabels = {
  name:           labelNameEl   ? labelNameEl.innerHTML   : "",
  site:           labelSiteEl   ? labelSiteEl.innerHTML   : "",
  service:        labelServiceEl? labelServiceEl.innerHTML: "",
  function_title: labelFuncEl   ? labelFuncEl.innerHTML   : ""
};

const redMsg = (msg) => `<span style="color:#e55353; font-weight:600;">${msg}</span>`;

async function transcribeProfileBlob(blob){
  if (statusMsg) statusMsg.textContent = "Transcription du profil en cours…";
  const form = new FormData();
  form.append("audio", blob, "profile.webm");

  const res  = await fetch("/api/transcribe", { method: "POST", body: form });
  const data = await res.json();

  if (!res.ok || !data.ok){
    if (statusMsg) statusMsg.textContent = (data && data.error) ? data.error : "Échec de la transcription du profil.";
    return;
  }

  profileDetectedLanguage   = data.language || "";
  profileOriginalText       = data.original_text || "";
  profileFrenchTranslation  = data.french_translation || "";

  if (profileLangChip){
    profileLangChip.textContent = profileDetectedLanguage
      ? `Langue détectée : ${profileDetectedLanguage}` : "";
  }
  if (profileOrigBox) profileOrigBox.textContent  = profileOriginalText  || "—";
  if (profileFrBox)  profileFrBox.textContent    = profileFrenchTranslation || "—";

  if (statusMsg) statusMsg.textContent = "Profil transcrit. Tu peux vérifier ce qui a été compris.";

  const textForAnalysis = profileFrenchTranslation || profileOriginalText || "";
  const normalized = textForAnalysis.toLowerCase().trim();
  const isSilence =
    !normalized ||
    /\[silence\]/i.test(normalized) ||
    /tonal sound|music only|background noise/.test(normalized) ||
    profileDetectedLanguage === "und";

  if (isSilence){
    profileReady   = false;
    profileSlots   = { name:null, site:null, service:null, function_title:null };
    profileMissing = ["name","site","service","function_title"];
    profileHints   = {};

    if (voiceMissingMsg){
      voiceMissingMsg.textContent =
        "⚠️ Je n’ai pas bien compris ton nom, ton site, ton service, ta fonction. " +
        "Tu pourras corriger ces informations à l’étape suivante ou refaire un enregistrement.";
    }

    updateProfileHintsUI();
    return;
  }

  await analyzeProfileTextForFields(textForAnalysis).catch(console.error);
}

function updateProfileHintsUI(){
  if (labelNameEl)    labelNameEl.innerHTML   = baseLabels.name;
  if (labelSiteEl)    labelSiteEl.innerHTML   = baseLabels.site;
  if (labelServiceEl) labelServiceEl.innerHTML= baseLabels.service;
  if (labelFuncEl)    labelFuncEl.innerHTML   = baseLabels.function_title;

  const hasTranscript = !!(profileOriginalText || profileFrenchTranslation);
  if (!hasTranscript) {
    if (voiceMissingMsg) voiceMissingMsg.textContent = "";
    return;
  }

  if (profileMissing.includes("name") && labelNameEl){
    const msg = profileHints.name || "Je n’ai pas bien compris ton nom, merci de le préciser ici.";
    labelNameEl.innerHTML = baseLabels.name + " " + redMsg(msg);
  }
  if (profileMissing.includes("site") && labelSiteEl){
    const msg = profileHints.site || "Je n’ai pas bien compris ton site, merci de le sélectionner ou le préciser.";
    labelSiteEl.innerHTML = baseLabels.site + " " + redMsg(msg);
  }
  if (profileMissing.includes("service") && labelServiceEl){
    const msg = profileHints.service || "Je n’ai pas bien compris ton service, merci de le préciser.";
    labelServiceEl.innerHTML = baseLabels.service + " " + redMsg(msg);
  }
  if (profileMissing.includes("function_title") && labelFuncEl){
    const msg = profileHints.function_title || "Je n’ai pas bien compris ta fonction, merci de la préciser.";
    labelFuncEl.innerHTML = baseLabels.function_title + " " + redMsg(msg);
  }

  if (!voiceMissingMsg) return;

  if (profileReady){
    voiceMissingMsg.textContent = "✔️ Toutes les informations semblent complètes. Tu pourras les corriger à la main si besoin.";
  } else {
    const human = {
      name:"ton nom",
      site:"ton site",
      service:"ton service",
      function_title:"ta fonction"
    };
    const items = profileMissing.map(k => human[k] || k);
    voiceMissingMsg.textContent =
      "⚠️ Je n’ai pas bien compris : " + items.join(", ") +
      ". Tu pourras corriger ces informations à l’étape suivante ou refaire un enregistrement si tu préfères.";
  }
}

async function analyzeProfileTextForFields(text){
  if (!text) return;

  const res = await fetch("/api/analyze_profile", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });
  const data = await res.json();

  if (!res.ok || !data.ok){
    console.warn("Analyse profil échouée :", data.error);
    return;
  }

  profileSlots   = data.profile || {};
  profileMissing = data.missing || [];
  profileHints   = data.hints   || {};

  if (!Array.isArray(profileMissing)) profileMissing = [];

  if (!profileSlots.name && !profileMissing.includes("name")) profileMissing.push("name");
  if (!profileSlots.site && !profileMissing.includes("site")) profileMissing.push("site");
  if (!profileSlots.service && !profileMissing.includes("service")) profileMissing.push("service");
  if (!profileSlots.function_title && !profileMissing.includes("function_title")) profileMissing.push("function_title");

  profileReady =
    !!profileSlots.name &&
    !!profileSlots.site &&
    !!profileSlots.service &&
    !!profileSlots.function_title &&
    profileMissing.length === 0;

  if (profileSlots.name && authorName) {
    authorName.value = profileSlots.name;
  }

  if (profileSlots.site && siteSelect) {
    const options = Array.from(siteSelect.options).map(o => o.value || o.textContent);
    if (options.includes(profileSlots.site)) {
      siteSelect.value = profileSlots.site;
      if (otherSiteRow && otherSite){
        otherSiteRow.style.display = "none";
        otherSite.value = "";
      }
    } else {
      siteSelect.value = "Autre";
      if (otherSiteRow && otherSite){
        otherSiteRow.style.display = "block";
        otherSite.value = profileSlots.site;
      }
    }
  }

  if (profileSlots.service && serviceSelect) {
    const optionsS = Array.from(serviceSelect.options).map(o => o.value || o.textContent);
    if (optionsS.includes(profileSlots.service)) {
      serviceSelect.value = profileSlots.service;
      if (otherServiceRow && otherService){
        otherServiceRow.style.display = "none";
        otherService.value = "";
      }
    } else {
      serviceSelect.value = "Autre";
      if (otherServiceRow && otherService){
        otherServiceRow.style.display = "block";
        otherService.value = profileSlots.service;
      }
    }
  }

  if (profileSlots.function_title && functionField) {
    functionField.value = profileSlots.function_title;
  }

  updateProfileHintsUI();
}

async function startProfileRecording(){
  if(!isSecure() || !(navigator.mediaDevices?.getUserMedia)){
    alert("HTTPS requis (ou localhost). Utilise plutôt l’import de fichier audio.");
    return;
  }
  try{
    try { if (profilePlayer && !profilePlayer.paused) profilePlayer.pause(); } catch(_){}
    if(profilePlayer) profilePlayer.hidden = true;

    if(profileStream) profileStream.getTracks().forEach(t => t.stop());

    const constraints = {
      audio: {
        echoCancellation:true,
        noiseSuppression:true,
        autoGainControl:true,
        channelCount:1,
        sampleRate:48000,
        sampleSize:16
      }
    };

    profileStream = await navigator.mediaDevices.getUserMedia(constraints);
    profileChunks = [];
    const mime = pickBestMime();

    profileMediaRecorder = new MediaRecorder(
      profileStream,
      mime ? { mimeType: mime } : undefined
    );

    profileMediaRecorder.ondataavailable = e => {
      if(e.data.size > 0) profileChunks.push(e.data);
    };
    profileMediaRecorder.onstop = async () => {
      const blob = new Blob(profileChunks, {
        type: profileMediaRecorder.mimeType || "audio/webm"
      });
      if (profilePlayer){
        profilePlayer.src = URL.createObjectURL(blob);
        profilePlayer.hidden = false;
      }
      await transcribeProfileBlob(blob);
      if(profileStream) profileStream.getTracks().forEach(t => t.stop());
    };

    profileMediaRecorder.start();
    if (profileRecBtn) profileRecBtn.textContent = "⏹️ Arrêter";
  } catch(err){
    alert("Impossible d'accéder au micro : " + err);
  }
}

function stopProfileRecording(){
  if(profileMediaRecorder && profileMediaRecorder.state !== "inactive"){
    profileMediaRecorder.stop();
    if (profileRecBtn) profileRecBtn.textContent = "🎙️ Démarrer l’enregistrement";
    if(profileStream) profileStream.getTracks().forEach(t => t.stop());
  }
}

profileRecBtn?.addEventListener("click", () => {
  (!profileMediaRecorder || profileMediaRecorder.state === "inactive")
    ? startProfileRecording()
    : stopProfileRecording();
});

profileUploadBtn?.addEventListener("click", () => profileAudioFile?.click());

profileAudioFile?.addEventListener("change", async () => {
  const file = profileAudioFile.files?.[0];
  if (!file) return;

  if (profilePlayer){
    profilePlayer.src = URL.createObjectURL(file);
    profilePlayer.hidden = false;
  }
  await transcribeProfileBlob(file);
});

// --- Étape 0 vocal : détection de langue + switch mobile ---

// Récupération des éléments DOM
const langRecBtn        = document.getElementById("langRecBtn");
const langSelect        = document.getElementById("langSelect");
const langUploadBtn     = document.getElementById("langUploadBtn");
const langAudioFile     = document.getElementById("langAudioFile");
const langTextBox       = document.getElementById("langTextBox");
const langDetectedRow   = document.getElementById("langDetectedRow");
const langConfirmRow    = document.getElementById("langConfirmRow");
const langConfirmLabel  = document.getElementById("langConfirmLabel");
const langConfirmYes    = document.getElementById("langConfirmYes");
const langConfirmNo     = document.getElementById("langConfirmNo");

const voiceLangCard     = document.getElementById("voiceLangCard");
const voiceProfileCard  = document.getElementById("voiceProfileCard");

const voiceLangTitle    = document.getElementById("voiceLangTitle");
const voiceLangIntro    = document.getElementById("voiceLangIntro");
const voiceLangList     = document.getElementById("voiceLangList");
const voiceLangNotice   = document.getElementById("voiceLangNotice");
const profileRecBtnMirror   = document.getElementById("profileRecBtnMirror");
const profileUploadBtnMirror= document.getElementById("profileUploadBtnMirror");

const voiceLangCol      = document.getElementById("voiceLangCol");
const voiceFrCol        = document.getElementById("voiceFrCol");
const voiceSwitch       = document.getElementById("voiceSwitch");
const voiceSwitchBtn    = document.getElementById("voiceSwitchBtn");
const voiceSwitchLabel  = document.getElementById("voiceSwitchLabel");

let langMediaRecorder = null, langChunks = [], langStream;
let currentLangCandidate = null;
let currentProfileLanguage = null;

// vue actuelle pour mobile
let currentVoiceView   = "native"; // "native" ou "fr"
let nativeDisplayLabel = "Langue choisie";

// Liste des langues pour le <select>
const LANGUAGE_OPTIONS = [
  { code: "af", fr: "Afrikaans", native: "Afrikaans" },
  { code: "ar", fr: "Arabe", native: "العربية" },
  { code: "bg", fr: "Bulgare", native: "Български" },
  { code: "ca", fr: "Catalan", native: "Català" },
  { code: "cs", fr: "Tchèque", native: "Čeština" },
  { code: "da", fr: "Danois", native: "Dansk" },
  { code: "de", fr: "Allemand", native: "Deutsch" },
  { code: "el", fr: "Grec", native: "Ελληνικά" },
  { code: "en", fr: "Anglais", native: "English" },
  { code: "es", fr: "Espagnol", native: "Español" },
  { code: "et", fr: "Estonien", native: "Eesti" },
  { code: "fa", fr: "Persan", native: "فارسی" },
  { code: "fi", fr: "Finnois", native: "Suomi" },
  { code: "fr", fr: "Français", native: "Français" },
  { code: "he", fr: "Hébreu", native: "עברית" },
  { code: "hi", fr: "Hindi", native: "हिन्दी" },
  { code: "hr", fr: "Croate", native: "Hrvatski" },
  { code: "hu", fr: "Hongrois", native: "Magyar" },
  { code: "id", fr: "Indonésien", native: "Bahasa Indonesia" },
  { code: "it", fr: "Italien", native: "Italiano" },
  { code: "ja", fr: "Japonais", native: "日本語" },
  { code: "ko", fr: "Coréen", native: "한국어" },
  { code: "lt", fr: "Lituanien", native: "Lietuvių" },
  { code: "lv", fr: "Letton", native: "Latviešu" },
  { code: "ms", fr: "Malais", native: "Bahasa Melayu" },
  { code: "nl", fr: "Néerlandais", native: "Nederlands" },
  { code: "no", fr: "Norvégien", native: "Norsk" },
  { code: "pl", fr: "Polonais", native: "Polski" },
  { code: "pt", fr: "Portugais", native: "Português" },
  { code: "ro", fr: "Roumain", native: "Română" },
  { code: "ru", fr: "Russe", native: "Русский" },
  { code: "sk", fr: "Slovaque", native: "Slovenčina" },
  { code: "sl", fr: "Slovène", native: "Slovenščina" },
  { code: "sr", fr: "Serbe", native: "Српски" },
  { code: "sv", fr: "Suédois", native: "Svenska" },
  { code: "th", fr: "Thaï", native: "ไทย" },
  { code: "tr", fr: "Turc", native: "Türkçe" },
  { code: "uk", fr: "Ukrainien", native: "Українська" },
  { code: "ur", fr: "Ourdou", native: "اُردُو" },
  { code: "vi", fr: "Vietnamien", native: "Tiếng Việt" },
  { code: "zh", fr: "Chinois", native: "中文" }
];

if (langSelect) {
  LANGUAGE_OPTIONS.forEach(({ code, fr, native }) => {
    const opt = document.createElement("option");
    opt.value = code;
    opt.textContent = native ? `${native} – ${fr}` : fr;
    langSelect.appendChild(opt);
  });
}

// gestion de la vue mobile
function updateVoiceView(target){
  currentVoiceView = target;

  // Desktop : les deux colonnes visibles, on ne force rien
  if (window.innerWidth > 900){
    if (voiceLangCol) voiceLangCol.classList.remove("is-active");
    if (voiceFrCol)  voiceFrCol.classList.remove("is-active");
    if (voiceSwitchLabel){
      voiceSwitchLabel.textContent = nativeDisplayLabel;
    }
    return;
  }

  if (!voiceLangCol || !voiceFrCol) return;

  if (target === "fr"){
    voiceLangCol.classList.remove("is-active");
    voiceFrCol.classList.add("is-active");
    if (voiceSwitchLabel){
      voiceSwitchLabel.textContent = "FR Français";
    }
  } else {
    voiceLangCol.classList.add("is-active");
    voiceFrCol.classList.remove("is-active");
    if (voiceSwitchLabel){
      voiceSwitchLabel.textContent = nativeDisplayLabel;
    }
  }
}

// clic sur le bouton de switch
voiceSwitchBtn?.addEventListener("click", () => {
  const next = (currentVoiceView === "native") ? "fr" : "native";
  updateVoiceView(next);
});

// resize : on repasse en double colonne sur desktop
window.addEventListener("resize", () => {
  if (window.innerWidth > 900){
    if (voiceLangCol) voiceLangCol.classList.remove("is-active");
    if (voiceFrCol)  voiceFrCol.classList.remove("is-active");
  } else {
    if (!voiceLangCol?.classList.contains("is-active") &&
        !voiceFrCol?.classList.contains("is-active")){
      updateVoiceView("native");
    } else {
      updateVoiceView(currentVoiceView);
    }
  }
});

// init à l’ouverture
if (window.innerWidth <= 900){
  updateVoiceView("native");
}

// Sélection manuelle de la langue
langSelect?.addEventListener("change", async () => {
  const code = langSelect.value;
  if (!code) return;

  const label = langSelect.options[langSelect.selectedIndex]?.text || code;

  if (langTextBox) {
    langTextBox.textContent = `Langue choisie : ${label}`;
  }
  if (langDetectedRow) langDetectedRow.textContent = "";
  if (langConfirmRow) langConfirmRow.style.display = "none";
  if (statusMsg) statusMsg.textContent = "Préparation de l’interface…";

  try {
    const res = await fetch("/api/voice_lang", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        language: code,
        original_text: "",
        french_translation: `Je veux parler en ${label}`
      })
    });
    const data = await res.json();

    if (res.ok && data.ok) {
      currentLangCandidate = data;
      applyChosenLanguage(data);
      if (statusMsg) statusMsg.textContent = "";
    } else {
      if (langDetectedRow) {
        langDetectedRow.textContent =
          "Impossible de préparer cette langue pour le moment.";
      }
      if (statusMsg) statusMsg.textContent = "";
    }
  } catch (e) {
    console.error("Erreur /api/voice_lang (select) :", e);
    if (langDetectedRow) {
      langDetectedRow.textContent =
        "Erreur lors du chargement de la langue.";
    }
    if (statusMsg) statusMsg.textContent = "";
  }
});

function applyChosenLanguage(langData) {
  currentProfileLanguage = langData;
  const ui = langData.ui || {};

  if (voiceLangTitle && ui.title) {
    voiceLangTitle.textContent = ui.title;
  }
  if (voiceLangIntro && ui.intro) {
    voiceLangIntro.textContent = ui.intro;
  }

  if (voiceLangList) {
    voiceLangList.innerHTML = "";
    (ui.items || []).forEach((txt, idx) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <span class="pill">${idx + 1}</span>
        <span>${txt}</span>
      `;
      voiceLangList.appendChild(li);
    });
  }

  if (profileRecBtnMirror && ui.rec_label) {
    profileRecBtnMirror.textContent = ui.rec_label;
  }
  if (profileUploadBtnMirror && ui.upload_label) {
    profileUploadBtnMirror.textContent = ui.upload_label;
  }
  if (voiceLangNotice && ui.notice) {
    voiceLangNotice.textContent = ui.notice;
  }
applyLanguageToProfile(langData);
applyLanguageToContact(langData);
applyLanguageToIdea(langData);
  // label utilisé côté mobile (ex : "العربية – Arabe")
  nativeDisplayLabel = `${langData.native_label} – ${langData.fr_label}`;
  if (voiceSwitchLabel){
    voiceSwitchLabel.textContent = nativeDisplayLabel;
  }

  if (voiceLangCard)   voiceLangCard.style.display = "none";
  if (voiceProfileCard) voiceProfileCard.style.display = "block";

  if (window.innerWidth <= 900){
    updateVoiceView("native");
  }

  window.scrollTo({ top: 0, behavior: "smooth" });
}

async function transcribeLangBlob(blob) {
  if (statusMsg) statusMsg.textContent = "Analyse de la langue en cours…";

  const form = new FormData();
  form.append("audio", blob, "lang.webm");

  const res = await fetch("/api/transcribe", { method: "POST", body: form });
  const data = await res.json();

  if (!res.ok || !data.ok) {
    if (statusMsg) {
      statusMsg.textContent = (data && data.error)
        ? data.error
        : "Échec de la détection de la langue.";
    }
    return;
  }

  const code = data.language || "";
  const orig = data.original_text || "";
  const fr   = data.french_translation || "";

  if (langTextBox) {
    langTextBox.textContent = orig || fr || "—";
  }

  let langInfo = null;
  try {
    const langRes = await fetch("/api/voice_lang", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        language: code,
        original_text: orig,
        french_translation: fr
      })
    });
    const langData = await langRes.json();
    if (langRes.ok && langData.ok) {
      langInfo = langData;
    }
  } catch (e) {
    console.warn("Erreur /api/voice_lang :", e);
  }

  if (!langInfo) {
    if (langDetectedRow) {
      langDetectedRow.textContent =
        "Je n’ai pas bien compris la langue. Peux-tu la redire (par exemple « en espagnol ») ?";
    }
    if (langConfirmRow) langConfirmRow.style.display = "none";
    if (statusMsg) statusMsg.textContent = "";
    return;
  }

  currentLangCandidate = langInfo;

  if (langDetectedRow) langDetectedRow.textContent = "";
  if (langConfirmLabel) {
    langConfirmLabel.textContent =
      `Langue détectée : ${langInfo.fr_label} (${langInfo.native_label}). Confirmer ?`;
  }
  if (langConfirmRow) langConfirmRow.style.display = "flex";
  if (statusMsg) statusMsg.textContent = "";
}

async function startLangRecording(){
  if(!isSecure() || !(navigator.mediaDevices?.getUserMedia)){
    alert("HTTPS requis (ou localhost). Utilise plutôt l’import de fichier audio.");
    return;
  }
  try{
    if(langStream) langStream.getTracks().forEach(t => t.stop());
    const constraints = {
      audio: {
        echoCancellation:true,
        noiseSuppression:true,
        autoGainControl:true,
        channelCount:1,
        sampleRate:48000,
        sampleSize:16
      }
    };
    langStream = await navigator.mediaDevices.getUserMedia(constraints);
    langChunks = [];
    const mime = pickBestMime();
    langMediaRecorder = new MediaRecorder(
      langStream,
      mime ? { mimeType: mime } : undefined
    );
    langMediaRecorder.ondataavailable = e => {
      if(e.data.size > 0) langChunks.push(e.data);
    };
    langMediaRecorder.onstop = async () => {
      const blob = new Blob(langChunks, {
        type: langMediaRecorder.mimeType || "audio/webm"
      });
      await transcribeLangBlob(blob);
      if (langStream) langStream.getTracks().forEach(t => t.stop());
    };
    langMediaRecorder.start();
    if (langRecBtn) langRecBtn.textContent = "⏹️ Arrêter";
  }catch(err){
    alert("Impossible d'accéder au micro : " + err);
  }
}

function stopLangRecording(){
  if(langMediaRecorder && langMediaRecorder.state !== "inactive"){
    langMediaRecorder.stop();
    if (langRecBtn) langRecBtn.textContent = "🎙️ Dire ma langue";
  }
}

langRecBtn?.addEventListener("click", () => {
  (!langMediaRecorder || langMediaRecorder.state === "inactive")
    ? startLangRecording()
    : stopLangRecording();
});

langUploadBtn?.addEventListener("click", () => langAudioFile?.click());

langAudioFile?.addEventListener("change", async () => {
  const file = langAudioFile?.files?.[0];
  if (!file) return;
  await transcribeLangBlob(file);
});

langConfirmNo?.addEventListener("click", () => {
  currentLangCandidate = null;
  if (langConfirmRow) langConfirmRow.style.display = "none";
  if (langDetectedRow) {
    langDetectedRow.textContent =
      "D’accord, tu peux recommencer en précisant mieux la langue (ex. « en espagnol »).";
  }
});

langConfirmYes?.addEventListener("click", () => {
  if (!currentLangCandidate) return;
  applyChosenLanguage(currentLangCandidate);
});

// Miroir des boutons côté langue choisie
profileRecBtnMirror?.addEventListener("click", () => profileRecBtn?.click());
profileUploadBtnMirror?.addEventListener("click", () => profileUploadBtn?.click());

// --- Navigation boutons profil / contacts / voix ---

const backToIntroBtn    = document.getElementById("backToIntro");
const nextFromProfileBtn= document.getElementById("nextFromProfile");
const backToProfileBtn  = document.getElementById("backToProfile");
const nextFromContactBtn= document.getElementById("nextFromContact");
const backToContactBtn  = document.getElementById("backToContact");
const backToModeVoice   = document.getElementById("backToModeVoice");
const nextFromVoice     = document.getElementById("nextFromVoice");
const backToHomeBtn     = document.getElementById("backToHomeBtn");

function validateProfileForm(){
  if (labelNameEl)    labelNameEl.innerHTML   = baseLabels.name;
  if (labelSiteEl)    labelSiteEl.innerHTML   = baseLabels.site;
  if (labelServiceEl) labelServiceEl.innerHTML= baseLabels.service;
  if (labelFuncEl)    labelFuncEl.innerHTML   = baseLabels.function_title;

  let ok = true;

  if (!authorName.value.trim()){
    if (labelNameEl){
      labelNameEl.innerHTML = baseLabels.name + " " + redMsg("Ce champ est obligatoire.");
    }
    ok = false;
  }

  const siteVal = siteSelect.value;
  const siteText = (siteVal === "Autre") ? (otherSite?.value.trim() || "") : siteVal;
  if (!siteText){
    if (labelSiteEl){
      labelSiteEl.innerHTML = baseLabels.site + " " + redMsg("Ce champ est obligatoire.");
    }
    ok = false;
  }

  const serviceVal = serviceSelect.value;
  const serviceText = (serviceVal === "Autre") ? (otherService?.value.trim() || "") : serviceVal;
  if (!serviceText){
    if (labelServiceEl){
      labelServiceEl.innerHTML = baseLabels.service + " " + redMsg("Ce champ est obligatoire.");
    }
    ok = false;
  }

  if (!functionField.value.trim()){
    if (labelFuncEl){
      labelFuncEl.innerHTML = baseLabels.function_title + " " + redMsg("Ce champ est obligatoire.");
    }
    ok = false;
  }

  if (!ok){
    const panel = document.querySelector("#step3 .panel");
    if (panel){
      const top = panel.getBoundingClientRect().top + window.scrollY - 80;
      window.scrollTo({ top, behavior:"smooth" });
    }
  }
  return ok;
}

backToIntroBtn?.addEventListener("click", () => showStep("step1"));
nextFromProfileBtn?.addEventListener("click", () => {
  if (validateProfileForm()) showStep("step4");
});
backToProfileBtn?.addEventListener("click", () => showStep("step3"));
nextFromContactBtn?.addEventListener("click", () => {
  showStep("step5");
  // En mode texte, activer la validation en temps réel
  if (chosenMode === "text") {
    validateTextModeForm();
  }
});
backToContactBtn?.addEventListener("click", () => showStep("step4"));

// --- Validation du formulaire en mode TEXTE ---
function validateTextModeForm() {
  if (chosenMode !== "text") return;
  
  const ideaTitle = document.getElementById("ideaTitle");
  const typedTextEl = document.getElementById("typedText");
  
  // En mode texte, on demande au minimum un titre OU une description
  const hasTitle = ideaTitle && ideaTitle.value.trim().length > 0;
  const hasDescription = typedTextEl && typedTextEl.value.trim().length > 0;
  
  if (hasTitle || hasDescription) {
    if (submitBtn) submitBtn.disabled = false;
  } else {
    if (submitBtn) submitBtn.disabled = true;
  }
}

// Écouteurs pour valider en temps réel en mode texte
document.getElementById("ideaTitle")?.addEventListener("input", validateTextModeForm);
document.getElementById("typedText")?.addEventListener("input", validateTextModeForm);

backToModeVoice?.addEventListener("click", () => {
  if (voiceProfileCard) voiceProfileCard.style.display = "none";
  if (voiceLangCard) voiceLangCard.style.display = "block";
});

nextFromVoice?.addEventListener("click", () => {
  showStep("step3");
  updateProfileHintsUI();
});

// bouton retour à l’accueil après la page Merci
backToHomeBtn?.addEventListener("click", () => {
  showStep("step1");
  const submitBar = document.querySelector(".submitbar");
  if (submitBar) submitBar.style.display = "flex";
  if (submitBtn) submitBtn.disabled = true;
  if (statusMsg) statusMsg.textContent = "";
});

// --- Soumission finale ---

submitBtn?.addEventListener("click", async () => {
  if (statusMsg) statusMsg.textContent = "Envoi…";

  let mediaPaths = [];
  if (mediaFiles.length > 0) {
    const formMedia = new FormData();
    mediaFiles.forEach((file, idx) => {
      formMedia.append("media", file, file.name || `media_${idx}`);
    });

    const mediaRes = await fetch("/api/upload_media", {
      method: "POST",
      body: formMedia
    });
    const mediaData = await mediaRes.json();

    if (mediaRes.ok && mediaData.ok) {
      mediaPaths = mediaData.paths || [];
    } else {
      if (statusMsg) statusMsg.textContent = "❌ Erreur lors de l’envoi des photos / vidéos.";
      return;
    }
  }

  const siteValue    = siteSelect.value === "Autre" ? (otherSite?.value || null)   : (siteSelect.value || null);
  const serviceValue = serviceSelect.value === "Autre" ? (otherService?.value || null) : (serviceSelect.value || null);
  const contactMode  = getContactMode();
  const shareTypes   = getShareTypes();
  const impactInfo   = getImpact();

  const payload = {
    author_name: authorName?.value || null,
    site: siteValue,
    service: serviceValue || null,
    function_title: functionField?.value || null,
    professional_email: proEmail?.value || null,
    contact_mode: contactMode || null,
    typed_text: typedText?.value || null,
    audio_path: null,
    detected_language: detectedLanguage || null,
    original_text: originalText || null,
    french_translation: frenchTranslation || null,
    idea_title: document.getElementById("ideaTitle")?.value || null,
    share_types: shareTypes,
    impact_main: impactInfo.impact,
    media_paths: mediaPaths,
    impact_other: impactInfo.impact_other
  };

  const res = await fetch("/api/submit", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  if (res.ok && data.ok) {
    // masquage de la barre de soumission + redirection vers la page Merci
    const submitBar = document.querySelector(".submitbar");
    if (submitBar) submitBar.style.display = "none";
    if (statusMsg) statusMsg.textContent = "";
    if (submitBtn) submitBtn.disabled = true;

    showStep("stepThanks");
  } else {
    if (statusMsg) statusMsg.textContent = "❌ Erreur d’enregistrement.";
  }
});

// --- PROFIL BILINGUE ---

const profileBilingualGrid = document.getElementById("profileBilingualGrid");
const profileLangCol = document.getElementById("profileLangCol");
const profileFrCol = document.getElementById("profileFrCol");
const profileSwitch = document.getElementById("profileSwitch");
const profileSwitchBtn = document.getElementById("profileSwitchBtn");
const profileSwitchLabel = document.getElementById("profileSwitchLabel");

const profileLangTitle = document.getElementById("profileLangTitle");
const profileLangIntro = document.getElementById("profileLangIntro");
const labelNameLang = document.getElementById("labelNameLang");
const labelSiteLang = document.getElementById("labelSiteLang");
const labelServiceLang = document.getElementById("labelServiceLang");
const labelFunctionLang = document.getElementById("labelFunctionLang");

const authorNameLang = document.getElementById("authorNameLang");
const countryLang = document.getElementById("countryLang");
const otherSiteRowLang = document.getElementById("otherSiteRowLang");
const otherSiteLang = document.getElementById("otherSiteLang");
const serviceSelectLang = document.getElementById("serviceSelectLang");
const otherServiceRowLang = document.getElementById("otherServiceRowLang");
const otherServiceLang = document.getElementById("otherServiceLang");
const functionFieldLang = document.getElementById("functionFieldLang");

let currentProfileView = "native"; // "native" ou "fr"
let profileNativeDisplayLabel = "Langue choisie";
let isProfileBilingual = false;

// Copier les options des selects FR vers les selects de la langue choisie
function copySelectOptions(sourceId, targetId) {
  const source = document.getElementById(sourceId);
  const target = document.getElementById(targetId);
  if (!source || !target) return;
  
  // Garder la première option (placeholder)
  const firstOption = target.options[0];
  target.innerHTML = "";
  target.appendChild(firstOption);
  
  // Copier les autres options
  for (let i = 1; i < source.options.length; i++) {
    const opt = document.createElement("option");
    opt.value = source.options[i].value;
    opt.textContent = source.options[i].textContent;
    target.appendChild(opt);
  }
}

// Initialiser les selects de la colonne langue
function initProfileLangSelects() {
  copySelectOptions("country", "countryLang");
  copySelectOptions("serviceSelect", "serviceSelectLang");
}

// Synchroniser les valeurs entre les deux colonnes
function syncProfileFields(fromLang = false) {
  if (fromLang) {
    // De la colonne langue vers FR
    if (authorName && authorNameLang) authorName.value = authorNameLang.value;
    if (siteSelect && countryLang) {
      siteSelect.value = countryLang.value;
      if (otherSiteRow && otherSiteRowLang && otherSite && otherSiteLang) {
        otherSiteRow.style.display = countryLang.value === "Autre" ? "block" : "none";
        otherSite.value = otherSiteLang.value;
      }
    }
    if (serviceSelect && serviceSelectLang) {
      serviceSelect.value = serviceSelectLang.value;
      if (otherServiceRow && otherServiceRowLang && otherService && otherServiceLang) {
        otherServiceRow.style.display = serviceSelectLang.value === "Autre" ? "block" : "none";
        otherService.value = otherServiceLang.value;
      }
    }
    if (functionField && functionFieldLang) functionField.value = functionFieldLang.value;
  } else {
    // De FR vers la colonne langue
    if (authorNameLang && authorName) authorNameLang.value = authorName.value;
    if (countryLang && siteSelect) {
      countryLang.value = siteSelect.value;
      if (otherSiteRowLang && otherSiteLang && otherSite) {
        otherSiteRowLang.style.display = siteSelect.value === "Autre" ? "block" : "none";
        otherSiteLang.value = otherSite.value;
      }
    }
    if (serviceSelectLang && serviceSelect) {
      serviceSelectLang.value = serviceSelect.value;
      if (otherServiceRowLang && otherServiceLang && otherService) {
        otherServiceRowLang.style.display = serviceSelect.value === "Autre" ? "block" : "none";
        otherServiceLang.value = otherService.value;
      }
    }
    if (functionFieldLang && functionField) functionFieldLang.value = functionField.value;
  }
}

// Événements de synchronisation
[authorName, siteSelect, otherSite, serviceSelect, otherService, functionField].forEach(el => {
  el?.addEventListener("input", () => syncProfileFields(false));
  el?.addEventListener("change", () => syncProfileFields(false));
});

[authorNameLang, countryLang, otherSiteLang, serviceSelectLang, otherServiceLang, functionFieldLang].forEach(el => {
  el?.addEventListener("input", () => syncProfileFields(true));
  el?.addEventListener("change", () => syncProfileFields(true));
});

// Gestion "Autre" pour les selects de la colonne langue
countryLang?.addEventListener("change", () => {
  if (otherSiteRowLang && otherSiteLang) {
    otherSiteRowLang.style.display = countryLang.value === "Autre" ? "block" : "none";
    if (countryLang.value !== "Autre") otherSiteLang.value = "";
  }
});

serviceSelectLang?.addEventListener("change", () => {
  if (otherServiceRowLang && otherServiceLang) {
    otherServiceRowLang.style.display = serviceSelectLang.value === "Autre" ? "block" : "none";
    if (serviceSelectLang.value !== "Autre") otherServiceLang.value = "";
  }
});

// Gestion de la vue mobile pour profil
function updateProfileView(target) {
  currentProfileView = target;
  
  if (window.innerWidth > 1000 || !isProfileBilingual) {
    if (profileLangCol) profileLangCol.classList.remove("is-active");
    if (profileFrCol) profileFrCol.classList.remove("is-active");
    return;
  }
  
  if (!profileLangCol || !profileFrCol) return;
  
  if (target === "fr") {
    profileLangCol.classList.remove("is-active");
    profileFrCol.classList.add("is-active");
    if (profileSwitchLabel) profileSwitchLabel.textContent = "FR Français";
  } else {
    profileLangCol.classList.add("is-active");
    profileFrCol.classList.remove("is-active");
    if (profileSwitchLabel) profileSwitchLabel.textContent = profileNativeDisplayLabel;
  }
}

// Clic sur le bouton de switch profil
profileSwitchBtn?.addEventListener("click", () => {
  const next = (currentProfileView === "native") ? "fr" : "native";
  updateProfileView(next);
});

// Appliquer la langue au profil (appelé après sélection de langue)
async function applyLanguageToProfile(langData) {
  if (!langData || langData.code === "fr") {
    // Français uniquement : mode colonne unique
    isProfileBilingual = false;
    if (profileBilingualGrid) profileBilingualGrid.classList.add("single-col");
    if (profileSwitch) profileSwitch.style.display = "none";
    return;
  }
  
  isProfileBilingual = true;
  if (profileBilingualGrid) profileBilingualGrid.classList.remove("single-col");
  
  // Mettre à jour le label pour le switch mobile
  profileNativeDisplayLabel = `${langData.native_label} – ${langData.fr_label}`;
  if (profileSwitchLabel) profileSwitchLabel.textContent = profileNativeDisplayLabel;
  
  // Demander la traduction des labels du formulaire profil
  try {
    const res = await fetch("/api/profile_lang", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ language: langData.code })
    });
    const data = await res.json();
    
    if (res.ok && data.ok) {
      const ui = data.ui || {};
      
      if (profileLangTitle && ui.title) profileLangTitle.textContent = ui.title;
      if (profileLangIntro && ui.intro) profileLangIntro.innerHTML = ui.intro;
      if (labelNameLang && ui.label_name) labelNameLang.textContent = ui.label_name;
      if (labelSiteLang && ui.label_site) labelSiteLang.textContent = ui.label_site;
      if (labelServiceLang && ui.label_service) labelServiceLang.textContent = ui.label_service;
      if (labelFunctionLang && ui.label_function) labelFunctionLang.textContent = ui.label_function;
      
      // Placeholders traduits
      if (authorNameLang && ui.placeholder_name) authorNameLang.placeholder = ui.placeholder_name;
      if (countryLang && ui.placeholder_site) countryLang.options[0].textContent = ui.placeholder_site;
      if (serviceSelectLang && ui.placeholder_service) serviceSelectLang.options[0].textContent = ui.placeholder_service;
      if (functionFieldLang && ui.placeholder_function) functionFieldLang.placeholder = ui.placeholder_function;
      if (otherSiteLang && ui.placeholder_other_site) otherSiteLang.placeholder = ui.placeholder_other_site;
      if (otherServiceLang && ui.placeholder_other_service) otherServiceLang.placeholder = ui.placeholder_other_service;
    }
  } catch (e) {
    console.warn("Erreur traduction profil :", e);
  }
  
  // Afficher le switch sur mobile
  if (profileSwitch && window.innerWidth <= 1000) {
    profileSwitch.style.display = "flex";
  }
  
  // Initialiser la vue
  if (window.innerWidth <= 1000) {
    updateProfileView("native");
  }
}

// Resize listener pour profil
window.addEventListener("resize", () => {
  if (!isProfileBilingual) return;
  
  if (window.innerWidth > 1000) {
    if (profileLangCol) profileLangCol.classList.remove("is-active");
    if (profileFrCol) profileFrCol.classList.remove("is-active");
    if (profileSwitch) profileSwitch.style.display = "none";
  } else {
    if (profileSwitch) profileSwitch.style.display = "flex";
    if (!profileLangCol?.classList.contains("is-active") &&
        !profileFrCol?.classList.contains("is-active")) {
      updateProfileView("native");
    }
  }
});

// Initialisation
initProfileLangSelects();


// --- STEP 4 CONTACT BILINGUE ---

const contactBilingualGrid = document.getElementById("contactBilingualGrid");
const contactLangCol = document.getElementById("contactLangCol");
const contactFrCol = document.getElementById("contactFrCol");
const contactSwitch = document.getElementById("contactSwitch");
const contactSwitchBtn = document.getElementById("contactSwitchBtn");
const contactSwitchLabel = document.getElementById("contactSwitchLabel");

// Éléments de la colonne langue
const step4Title = document.getElementById("step4Title");
const sectionLabelCoordsLang = document.getElementById("sectionLabelCoordsLang");
const sectionLabelPrefLang = document.getElementById("sectionLabelPrefLang");
const contactBlockTitleEmailLang = document.getElementById("contactBlockTitleEmailLang");
const labelProEmailLang = document.getElementById("labelProEmailLang");
const proEmailLang = document.getElementById("proEmailLang");
const fieldNoteEmailLang = document.getElementById("fieldNoteEmailLang");
const contactBlockTitlePrefLang = document.getElementById("contactBlockTitlePrefLang");
const radioMailLang = document.getElementById("radioMailLang");
const radioManagerLang = document.getElementById("radioManagerLang");

let currentContactView = "native"; // "native" ou "fr"
let contactNativeDisplayLabel = "Langue choisie";
let isContactBilingual = false;

// Synchroniser les valeurs entre les deux colonnes
function syncContactFields(fromLang = false) {
  const proEmail = document.getElementById("proEmail");
  
  if (fromLang) {
    // De la colonne langue vers FR
    if (proEmail && proEmailLang) proEmail.value = proEmailLang.value;
    
    // Synchroniser les radio buttons
    const checkedLang = document.querySelector("input[name='contactModeLang']:checked");
    if (checkedLang) {
      const frRadio = document.querySelector(`input[name='contactMode'][value='${checkedLang.value}']`);
      if (frRadio) frRadio.checked = true;
    }
  } else {
    // De FR vers la colonne langue
    if (proEmailLang && proEmail) proEmailLang.value = proEmail.value;
    
    // Synchroniser les radio buttons
    const checkedFr = document.querySelector("input[name='contactMode']:checked");
    if (checkedFr) {
      const langRadio = document.querySelector(`input[name='contactModeLang'][value='${checkedFr.value}']`);
      if (langRadio) langRadio.checked = true;
    }
  }
}

// Événements de synchronisation pour l'email
document.getElementById("proEmail")?.addEventListener("input", () => syncContactFields(false));
proEmailLang?.addEventListener("input", () => syncContactFields(true));

// Événements de synchronisation pour les radio buttons
document.querySelectorAll("input[name='contactMode']").forEach(radio => {
  radio.addEventListener("change", () => syncContactFields(false));
});
document.querySelectorAll("input[name='contactModeLang']").forEach(radio => {
  radio.addEventListener("change", () => syncContactFields(true));
});

// Gestion de la vue mobile pour contact
function updateContactView(target) {
  currentContactView = target;
  
  if (window.innerWidth > 1000 || !isContactBilingual) {
    if (contactLangCol) contactLangCol.classList.remove("is-active");
    if (contactFrCol) contactFrCol.classList.remove("is-active");
    return;
  }
  
  if (!contactLangCol || !contactFrCol) return;
  
  if (target === "fr") {
    contactLangCol.classList.remove("is-active");
    contactFrCol.classList.add("is-active");
    if (contactSwitchLabel) contactSwitchLabel.textContent = "FR Français";
  } else {
    contactLangCol.classList.add("is-active");
    contactFrCol.classList.remove("is-active");
    if (contactSwitchLabel) contactSwitchLabel.textContent = contactNativeDisplayLabel;
  }
}

// Clic sur le bouton de switch contact
contactSwitchBtn?.addEventListener("click", () => {
  const next = (currentContactView === "native") ? "fr" : "native";
  updateContactView(next);
});

// Appliquer la langue aux coordonnées (appelé après sélection de langue)
async function applyLanguageToContact(langData) {
  if (!langData || langData.code === "fr") {
    // Français uniquement : mode colonne unique
    isContactBilingual = false;
    if (contactBilingualGrid) contactBilingualGrid.classList.add("single-col");
    if (contactSwitch) contactSwitch.style.display = "none";
    return;
  }
  
  isContactBilingual = true;
  if (contactBilingualGrid) contactBilingualGrid.classList.remove("single-col");
  
  // Mettre à jour le label pour le switch mobile
  contactNativeDisplayLabel = `${langData.native_label} – ${langData.fr_label}`;
  if (contactSwitchLabel) contactSwitchLabel.textContent = contactNativeDisplayLabel;
  
  // Demander la traduction des labels du formulaire contact
  try {
    const res = await fetch("/api/contact_lang", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ language: langData.code })
    });
    const data = await res.json();
    
    if (res.ok && data.ok) {
      const ui = data.ui || {};
      
      // Titre principal (affiché au-dessus des deux colonnes)
      // On ne le change pas car il reste en FR pour cohérence
      
      // Section labels
      if (sectionLabelCoordsLang && ui.section_coords) sectionLabelCoordsLang.textContent = ui.section_coords;
      if (sectionLabelPrefLang && ui.section_pref) sectionLabelPrefLang.textContent = ui.section_pref;
      
      // Bloc email
      if (contactBlockTitleEmailLang && ui.email_title) contactBlockTitleEmailLang.textContent = ui.email_title;
      if (labelProEmailLang && ui.email_label) labelProEmailLang.textContent = ui.email_label;
      if (proEmailLang && ui.email_placeholder) proEmailLang.placeholder = ui.email_placeholder;
      if (fieldNoteEmailLang && ui.email_note) fieldNoteEmailLang.textContent = ui.email_note;
      
      // Bloc préférence de contact
      if (contactBlockTitlePrefLang && ui.pref_title) contactBlockTitlePrefLang.textContent = ui.pref_title;
      if (radioMailLang && ui.radio_mail) radioMailLang.textContent = ui.radio_mail;
      if (radioManagerLang && ui.radio_manager) radioManagerLang.textContent = ui.radio_manager;
    }
  } catch (e) {
    console.warn("Erreur traduction contact :", e);
  }
  
  // Afficher le switch sur mobile
  if (contactSwitch && window.innerWidth <= 1000) {
    contactSwitch.style.display = "flex";
  }
  
  // Initialiser la vue
  if (window.innerWidth <= 1000) {
    updateContactView("native");
  }
}

// Resize listener pour contact
window.addEventListener("resize", () => {
  if (!isContactBilingual) return;
  
  if (window.innerWidth > 1000) {
    if (contactLangCol) contactLangCol.classList.remove("is-active");
    if (contactFrCol) contactFrCol.classList.remove("is-active");
    if (contactSwitch) contactSwitch.style.display = "none";
  } else {
    if (contactSwitch) contactSwitch.style.display = "flex";
    if (!contactLangCol?.classList.contains("is-active") &&
        !contactFrCol?.classList.contains("is-active")) {
      updateContactView("native");
    }
  }
});

// NOTE: Appeler applyLanguageToContact(langData) dans la fonction applyChosenLanguage existante



// --- STEP 5 IDEA BILINGUE ---

const ideaHeaderBilingual = document.getElementById("ideaHeaderBilingual");
const ideaHeaderLang = document.getElementById("ideaHeaderLang");
const ideaHeaderFr = document.getElementById("ideaHeaderFr");
const ideaSwitch = document.getElementById("ideaSwitch");
const ideaSwitchBtn = document.getElementById("ideaSwitchBtn");
const ideaSwitchLabel = document.getElementById("ideaSwitchLabel");

// Éléments à traduire
const ideaPanelTitleLang = document.getElementById("ideaPanelTitleLang");
const ideaPanelIntroLang = document.getElementById("ideaPanelIntroLang");
const labelTypeLang = document.getElementById("labelTypeLang");
const checkDifficultyLang = document.getElementById("checkDifficultyLang");
const checkImprovementLang = document.getElementById("checkImprovementLang");
const checkInnovationLang = document.getElementById("checkInnovationLang");
const labelIdeaTitleLang = document.getElementById("labelIdeaTitleLang");
const labelDescriptionLang = document.getElementById("labelDescriptionLang");
const labelImpactLang = document.getElementById("labelImpactLang");
const labelRecordingLang = document.getElementById("labelRecordingLang");
const btnRecLang = document.getElementById("btnRecLang");
const btnUploadLang = document.getElementById("btnUploadLang");
const btnToneLang = document.getElementById("btnToneLang");
const labelMediaLang = document.getElementById("labelMediaLang");
const labelPhotosLang = document.getElementById("labelPhotosLang");
const btnCaptureLang = document.getElementById("btnCaptureLang");
const btnMediaUploadLang = document.getElementById("btnMediaUploadLang");
const btnBackLang = document.getElementById("btnBackLang");
const previewTitleLang = document.getElementById("previewTitleLang");
const previewIntroLang = document.getElementById("previewIntroLang");
const previewOrigLabelLang = document.getElementById("previewOrigLabelLang");
const previewFrLabelLang = document.getElementById("previewFrLabelLang");
const helperTextLang = document.getElementById("helperTextLang");

let currentIdeaView = "native"; // "native" ou "fr"
let ideaNativeDisplayLabel = "Langue choisie";
let isIdeaBilingual = false;

// Gestion de la vue mobile pour idea
function updateIdeaView(target) {
  currentIdeaView = target;
  
  const allLangElements = document.querySelectorAll("#step5 .label-lang, #step5 .text-lang, #step5 .idea-header-lang");
  const allFrElements = document.querySelectorAll("#step5 .label-fr, #step5 .text-fr, #step5 .idea-header-fr");
  
  if (window.innerWidth > 1000 || !isIdeaBilingual) {
    // Desktop : tout visible
    allLangElements.forEach(el => el.classList.remove("is-active"));
    allFrElements.forEach(el => el.classList.remove("is-active"));
    return;
  }
  
  if (target === "fr") {
    allLangElements.forEach(el => el.classList.remove("is-active"));
    allFrElements.forEach(el => el.classList.add("is-active"));
    if (ideaSwitchLabel) ideaSwitchLabel.textContent = "FR Français";
  } else {
    allLangElements.forEach(el => el.classList.add("is-active"));
    allFrElements.forEach(el => el.classList.remove("is-active"));
    if (ideaSwitchLabel) ideaSwitchLabel.textContent = ideaNativeDisplayLabel;
  }
}

// Clic sur le bouton de switch idea
ideaSwitchBtn?.addEventListener("click", () => {
  const next = (currentIdeaView === "native") ? "fr" : "native";
  updateIdeaView(next);
});

// Appliquer le mode single-lang (français uniquement)
function setIdeaSingleLang() {
  isIdeaBilingual = false;
  
  if (ideaHeaderBilingual) ideaHeaderBilingual.classList.add("single-lang");
  if (ideaSwitch) ideaSwitch.style.display = "none";
  
  // Ajouter single-lang à tous les éléments bilingues
  document.querySelectorAll("#step5 .bilingual-label").forEach(el => el.classList.add("single-lang"));
  document.querySelectorAll("#step5 .bilingual-text").forEach(el => el.classList.add("single-lang"));
}

// Appliquer la langue à step5 (appelé après sélection de langue)
/* ============================================================
   STEP 5 - JAVASCRIPT SIMPLIFIÉ (langue unique)
   Remplace la fonction applyLanguageToIdea dans ton JS
   ============================================================ */

// Variables globales pour step5
let isIdeaFrenchOnly = true; // Par défaut, français uniquement

// Fonction simplifiée - affiche uniquement la langue choisie
async function applyLanguageToIdea(langData) {
  console.log("applyLanguageToIdea appelé avec:", langData);
  
  const langCode = langData?.code || langData?.language || null;
  const step5 = document.getElementById("step5");
  const ideaHeaderBilingual = document.getElementById("ideaHeaderBilingual");
  
  // Si pas de langue ou français → mode français uniquement
  if (!langData || !langCode || langCode === "fr") {
    console.log("Mode français uniquement pour step5");
    isIdeaFrenchOnly = true;
    
    if (step5) step5.classList.add("french-only");
    if (ideaHeaderBilingual) ideaHeaderBilingual.classList.add("french-only");
    
    return;
  }
  
  // Mode langue choisie (ex: danois, espagnol, etc.)
  console.log("Mode langue choisie pour step5:", langCode);
  isIdeaFrenchOnly = false;
  
  if (step5) step5.classList.remove("french-only");
  if (ideaHeaderBilingual) ideaHeaderBilingual.classList.remove("french-only");
  
  // Demander la traduction à l'API
  try {
    console.log("Appel API /api/idea_lang avec code:", langCode);
    const res = await fetch("/api/idea_lang", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ language: langCode })
    });
    const data = await res.json();
    console.log("Réponse /api/idea_lang:", data);
    
    if (res.ok && data.ok && data.ui) {
      const ui = data.ui;
      
      // === EN-TÊTE ===
      const ideaPanelTitleLang = document.getElementById("ideaPanelTitleLang");
      const ideaPanelIntroLang = document.getElementById("ideaPanelIntroLang");
      
      if (ideaPanelTitleLang && ui.panel_title) ideaPanelTitleLang.textContent = ui.panel_title;
      if (ideaPanelIntroLang && ui.panel_intro) ideaPanelIntroLang.textContent = ui.panel_intro;
      
      // === TYPE DE CONTRIBUTION ===
      const labelTypeLang = document.getElementById("labelTypeLang");
      const checkDifficultyLang = document.getElementById("checkDifficultyLang");
      const checkImprovementLang = document.getElementById("checkImprovementLang");
      const checkInnovationLang = document.getElementById("checkInnovationLang");
      
      if (labelTypeLang && ui.label_type) labelTypeLang.textContent = ui.label_type;
      if (checkDifficultyLang && ui.check_difficulty) checkDifficultyLang.textContent = ui.check_difficulty;
      if (checkImprovementLang && ui.check_improvement) checkImprovementLang.textContent = ui.check_improvement;
      if (checkInnovationLang && ui.check_innovation) checkInnovationLang.textContent = ui.check_innovation;
      
      // === TITRE ET DESCRIPTION ===
      const labelIdeaTitleLang = document.getElementById("labelIdeaTitleLang");
      const labelDescriptionLang = document.getElementById("labelDescriptionLang");
      const ideaTitle = document.getElementById("ideaTitle");
      const typedText = document.getElementById("typedText");
      
      if (labelIdeaTitleLang && ui.label_title) labelIdeaTitleLang.textContent = ui.label_title;
      if (labelDescriptionLang && ui.label_description) labelDescriptionLang.textContent = ui.label_description;
      if (ideaTitle && ui.placeholder_title) ideaTitle.placeholder = ui.placeholder_title;
      if (typedText && ui.placeholder_description) typedText.placeholder = ui.placeholder_description;
      
      // === IMPACT ===
      const labelImpactLang = document.getElementById("labelImpactLang");
      const impactSelect = document.getElementById("impactSelect");
      
      if (labelImpactLang && ui.label_impact) labelImpactLang.textContent = ui.label_impact;
      
      // Traduire les options du select
      if (impactSelect && ui.impact_options) {
        const opts = ui.impact_options;
        if (opts.placeholder && impactSelect.options[0]) impactSelect.options[0].textContent = opts.placeholder;
        if (opts.ergonomie && impactSelect.options[1]) impactSelect.options[1].textContent = opts.ergonomie;
        if (opts.environnement && impactSelect.options[2]) impactSelect.options[2].textContent = opts.environnement;
        if (opts.efficacite && impactSelect.options[3]) impactSelect.options[3].textContent = opts.efficacite;
        if (opts.productivite && impactSelect.options[4]) impactSelect.options[4].textContent = opts.productivite;
        if (opts.energie && impactSelect.options[5]) impactSelect.options[5].textContent = opts.energie;
        if (opts.securite && impactSelect.options[6]) impactSelect.options[6].textContent = opts.securite;
        if (opts.autre && impactSelect.options[7]) impactSelect.options[7].textContent = opts.autre;
      }
      
      // === ENREGISTREMENT VOCAL ===
      const labelRecordingLang = document.getElementById("labelRecordingLang");
      const btnRecLang = document.getElementById("btnRecLang");
      const btnUploadLang = document.getElementById("btnUploadLang");
      const btnToneLang = document.getElementById("btnToneLang");
      
      if (labelRecordingLang && ui.label_recording) labelRecordingLang.textContent = ui.label_recording;
      if (btnRecLang && ui.btn_rec) btnRecLang.textContent = ui.btn_rec;
      if (btnUploadLang && ui.btn_upload) btnUploadLang.textContent = ui.btn_upload;
      if (btnToneLang && ui.btn_tone) btnToneLang.textContent = ui.btn_tone;
      
      // === MÉDIAS ===
      const labelMediaLang = document.getElementById("labelMediaLang");
      const labelPhotosLang = document.getElementById("labelPhotosLang");
      const btnCaptureLang = document.getElementById("btnCaptureLang");
      const btnMediaUploadLang = document.getElementById("btnMediaUploadLang");
      
      if (labelMediaLang && ui.label_media) labelMediaLang.textContent = ui.label_media;
      if (labelPhotosLang && ui.label_photos) labelPhotosLang.textContent = ui.label_photos;
      if (btnCaptureLang && ui.btn_capture) btnCaptureLang.textContent = ui.btn_capture;
      if (btnMediaUploadLang && ui.btn_media_upload) btnMediaUploadLang.textContent = ui.btn_media_upload;
      
      // === NAVIGATION ===
      const btnBackLang = document.getElementById("btnBackLang");
      if (btnBackLang && ui.btn_back) btnBackLang.textContent = ui.btn_back;
      
      // === APERÇU ===
      const previewTitleLang = document.getElementById("previewTitleLang");
      const previewIntroLang = document.getElementById("previewIntroLang");
      const previewOrigLabelLang = document.getElementById("previewOrigLabelLang");
      const previewFrLabelLang = document.getElementById("previewFrLabelLang");
      const helperTextLang = document.getElementById("helperTextLang");
      
      if (previewTitleLang && ui.preview_title) previewTitleLang.textContent = ui.preview_title;
      if (previewIntroLang && ui.preview_intro) previewIntroLang.textContent = ui.preview_intro;
      if (previewOrigLabelLang && ui.preview_orig_label) previewOrigLabelLang.textContent = ui.preview_orig_label;
      if (previewFrLabelLang && ui.preview_fr_label) previewFrLabelLang.textContent = ui.preview_fr_label;
      if (helperTextLang && ui.helper_text) helperTextLang.textContent = ui.helper_text;
      
      console.log("✅ Traductions step5 appliquées avec succès");
    } else {
      console.warn("⚠️ Réponse API idea_lang invalide ou vide:", data);
    }
  } catch (e) {
    console.error("❌ Erreur traduction idea :", e);
  }
}

// Fonction pour réinitialiser step5 en français (si besoin)
function resetIdeaToFrench() {
  isIdeaFrenchOnly = true;
  const step5 = document.getElementById("step5");
  const ideaHeaderBilingual = document.getElementById("ideaHeaderBilingual");
  
  if (step5) step5.classList.add("french-only");
  if (ideaHeaderBilingual) ideaHeaderBilingual.classList.add("french-only");
}

// Resize listener pour idea
window.addEventListener("resize", () => {
  if (!isIdeaBilingual) return;
  
  if (window.innerWidth > 1000) {
    const allLangElements = document.querySelectorAll("#step5 .label-lang, #step5 .text-lang, #step5 .idea-header-lang");
    const allFrElements = document.querySelectorAll("#step5 .label-fr, #step5 .text-fr, #step5 .idea-header-fr");
    allLangElements.forEach(el => el.classList.remove("is-active"));
    allFrElements.forEach(el => el.classList.remove("is-active"));
    if (ideaSwitch) ideaSwitch.style.display = "none";
  } else {
    if (ideaSwitch) ideaSwitch.style.display = "flex";
    updateIdeaView(currentIdeaView);
  }
});

// NOTE: Appeler applyLanguageToIdea(langData) dans la fonction applyChosenLanguage existante
function setStep5VoiceMode() {
  const step5 = document.getElementById("step5");
  if (step5) {
    step5.classList.add("voice-mode");
    step5.classList.remove("text-mode");
    
    // Retirer les classes de masquage du mode texte
    const voiceRecordingGroup = step5.querySelector(".voice-recording-group");
    if (voiceRecordingGroup) {
      voiceRecordingGroup.classList.remove("hide-text-mode");
    }
    
    // Fallback pour navigateurs sans :has() - ajouter classe aux field-groups à masquer
    const fieldGroups = step5.querySelectorAll(".field-group");
    fieldGroups.forEach(fg => {
      // Vérifier si ce field-group contient les éléments à masquer
      if (fg.querySelector("#ideaTitle") || 
          fg.querySelector("#typedText") || 
          fg.querySelector("#impactSelect") ||
          fg.querySelector(".choice-row") ||
          fg.querySelector("input[name='shareType']")) {
        fg.classList.add("hide-voice-mode");
      }
    });
    
    console.log("✅ Step5 en mode VOCAL - champs texte masqués, panneau aperçu visible");
  }
}

/**
 * Active le mode texte sur step5 (affiche tous les champs sauf vocal/aperçu)
 * Appelle cette fonction quand l'utilisateur choisit le mode texte
 */
function setStep5TextMode() {
  const step5 = document.getElementById("step5");
  if (step5) {
    step5.classList.add("text-mode");
    step5.classList.remove("voice-mode");
    
    // Retirer les classes de masquage vocal
    const fieldGroups = step5.querySelectorAll(".field-group");
    fieldGroups.forEach(fg => {
      fg.classList.remove("hide-voice-mode");
    });
    
    // Fallback pour navigateurs sans :has() - masquer les éléments vocaux
    const voiceRecordingGroup = step5.querySelector(".voice-recording-group");
    if (voiceRecordingGroup) {
      voiceRecordingGroup.classList.add("hide-text-mode");
    }
    
    console.log("✅ Step5 en mode TEXTE - éléments vocaux masqués, robot dans l'en-tête");
  }
}
</script>

</body>
</html>